<!DOCTYPE html>
<html lang="ja">
<head>
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JL8DFLM6C5"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-JL8DFLM6C5');</script>
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8425980752738373" crossorigin="anonymous"></script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PITA診断 | あなたは何主義者として生きるのか。</title>
    <meta name="description" content="100の質問があなたの魂の形を決定づける。深層に潜む『イズム』を解剖する精密診断システム。(Core v14.7)">
    
    <!-- OGP Settings - Cache Buster v14.7 -->
    <meta property="og:title" content="PITA診断 | あなたは何主義者として生きるのか">
    <meta property="og:description" content="100の質問であなたの深層心理を解剖。魂の形を特定せよ。(Core v14.7)">
    <meta property="og:image" content="https://pita-diagnosis.com/ogp-image.png?v=14.7">
    <meta property="og:url" content="https://pita-diagnosis.com/">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://pita-diagnosis.com/ogp-image.png?v=14.7">
    <link rel="canonical" href="https://pita-diagnosis.com/">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@700&family=Noto+Sans+JP:wght@300;400;700&display=swap" rel="stylesheet">
    
    <style>
        :root { --primary: #111111; --accent: #3b82f6; --bg-gray: #fcfcfc; }
        html { scroll-behavior: smooth; }
        body { font-family: 'Noto Sans JP', sans-serif; background-color: #ffffff; color: var(--primary); -webkit-font-smoothing: antialiased; text-wrap: balance; overflow-x: hidden; }
        .serif { font-family: 'Noto Serif JP', serif; }
        .btn-choice { transition: all 0.2s; border: 1px solid #eeeeee; background: #ffffff; cursor: pointer; }
        .btn-choice:hover { border-color: var(--accent); background: #fafdff; }
        .btn-line { background: #06C755; color: white; }
        .btn-stripe { background: #635bff; color: white; transition: all 0.2s; }
        .btn-stripe:hover { background: #5247e5; transform: translateY(-1px); }
        .btn-secondary { transition: all 0.2s; border: 1px solid #e5e7eb; background: #fff; }
        .btn-secondary:hover { border-color: var(--accent); color: var(--accent); }
        .progress-bar { transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .img-slot { aspect-ratio: 1/1; width: 100%; max-width: 320px; margin: 0 auto; border-radius: 50%; background-color: var(--bg-gray); overflow: hidden; display: flex; align-items: center; justify-content: center; border: 1px solid #eeeeee; }
        .result-img { opacity: 0; transition: opacity 1.2s ease-in-out; width: 100%; height: 100%; object-fit: cover; }
        .img-loaded .result-img { opacity: 1; }
        
        .ticker-container { width: 100%; overflow: hidden; white-space: nowrap; background: #fafafa; padding: 14px 0; border-top: 1px solid #eee; border-bottom: 1px solid #eee; margin-bottom: 2px; }
        .ticker-row { display: inline-flex; animation: ticker-scroll 40s linear infinite; }
        @keyframes ticker-scroll { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
        .ticker-item { display: inline-block; margin: 0 40px; font-weight: 700; color: #888; font-size: 0.95rem; }
        .ticker-char { color: var(--accent); opacity: 0.8; }

        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.4); backdrop-blur: 4px; z-index: 100; display: flex; align-items: center; justify-content: center; padding: 1.5rem; }
        .modal-content { background: white; width: 100%; max-width: 500px; border-radius: 2.5rem; position: relative; padding: 2.5rem; box-shadow: 0 25px 50px rgba(0,0,0,0.15); }
        .hidden { display: none; }
        .fade-in { animation: fadeIn 0.8s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .ism-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 1rem; }
        .ism-card { background: #fff; border: 1px solid #f0f0f0; border-radius: 1.5rem; padding: 1.5rem 1rem; transition: all 0.3s; text-align: center; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; }
        .ism-card:hover { border-color: var(--accent); transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,0,0,0.05); }

        .adsense-unit { min-height: 100px; background: #fafafa; border: 1px dashed #ddd; margin: 2rem 0; display: flex; align-items: center; justify-content: center; font-size: 10px; color: #ccc; border-radius: 1rem; }
    </style>
</head>
<body class="min-h-screen flex flex-col text-slate-900">

    <nav class="p-4 md:p-8 flex justify-between items-center border-b border-gray-50 bg-white/80 backdrop-blur-md sticky top-0 z-50">
        <div class="flex flex-col cursor-pointer select-none" onclick="window.devClick()">
            <div class="text-2xl md:text-3xl font-black tracking-tighter serif leading-none text-slate-900">PITA</div>
            <div class="text-[7px] md:text-[8px] font-bold text-gray-400 tracking-[0.15em] uppercase mt-1">Personality Ism Type Analyzer</div>
        </div>
        <div class="text-[9px] font-bold text-blue-600 tracking-widest uppercase italic border-l pl-4 border-gray-100 text-right">Core v14.7</div>
    </nav>

    <!-- Developer Menu -->
    <div id="dev-menu" class="hidden fixed top-[10%] left-1/2 -translate-x-1/2 w-[90%] max-w-md bg-black p-8 rounded-3xl z-[1000] text-white text-center">
        <p class="mb-4 font-bold border-b border-gray-700 pb-2 text-blue-400 uppercase text-xs text-center">Debug Preview</p>
        <div class="grid grid-cols-2 gap-2 text-center text-xs">
            <button onclick="window.jumpToResult('ALT')" class="p-2 bg-gray-800 rounded">利他</button><button onclick="window.jumpToResult('EGO')" class="p-2 bg-gray-800 rounded">利己</button>
            <button onclick="window.jumpToResult('OPT')" class="p-2 bg-gray-800 rounded">楽観</button><button onclick="window.jumpToResult('NIH')" class="p-2 bg-gray-800 rounded">虚無</button>
            <button onclick="window.jumpToResult('IDE')" class="p-2 bg-gray-800 rounded">理想</button><button onclick="window.jumpToResult('REA')" class="p-2 bg-gray-800 rounded">現実</button>
            <button onclick="window.jumpToResult('MOD')" class="p-2 bg-gray-800 rounded">秩序</button><button onclick="window.jumpToResult('ANA')" class="p-2 bg-gray-800 rounded">混沌</button>
        </div>
        <button class="mt-6 w-full text-red-400 font-bold p-2" onclick="document.getElementById('dev-menu').classList.add('hidden')">CLOSE</button>
    </div>

    <!-- PITA Index Modal -->
    <div id="index-modal" class="modal-overlay hidden" onclick="window.closeIndexModal(event)">
        <div class="modal-content fade-in" onclick="event.stopPropagation()">
            <button onclick="window.toggleIndexModal(false)" class="absolute top-6 right-6 text-2xl font-light text-gray-400 hover:text-black transition">×</button>
            <h3 class="text-xl font-bold mb-6 serif border-b pb-4 text-center">PITA Indexとは何か？</h3>
            <div class="space-y-6 text-sm text-gray-600 leading-relaxed overflow-y-auto max-h-[60vh] pr-2 text-left">
                <p>PITA Indexは、100の質問への回答プロセスを通じて算出される、あなたの<strong>「主義の純度」</strong>と<strong>「魂の解像度」</strong>を統合した独自指標です。</p>
                <div>
                    <h4 class="font-bold text-gray-900 mb-2">1. 主義の純度 (Purity)</h4>
                    <p>あなたが特定の価値観に対してどれだけ揺るぎない確信を持っているかを測定します。Indexが高いほど、あなたの思考の軸が強固であることを示します。</p>
                </div>
                <div>
                    <h4 class="font-bold text-gray-900 mb-2">2. 魂の解像度 (Resolution)</h4>
                    <p>自己に対する嘘や無意識のバイアスを排除できているかを示します。アルゴリズムは回答の矛盾を検知し、客観性を評価します。</p>
                </div>
            </div>
        </div>
    </div>

    <main class="flex-grow flex flex-col items-center justify-start bg-[#ffffff]">
        
        <!-- Intro Screen -->
        <div id="intro" class="max-w-4xl w-full text-center py-12 md:py-24 px-6 text-balance">
            <div class="mb-4 inline-block px-4 py-1 rounded-full border border-gray-100 text-[9px] font-black tracking-widest text-gray-400 uppercase">Identity Structure Verification</div>
            <h2 class="text-4xl md:text-7xl font-bold mb-8 serif">あなたは何主義者として<br><span class="text-blue-600">生きるのか。</span></h2>
            <p class="text-gray-500 mb-12 leading-relaxed text-sm md:text-base tracking-widest max-w-lg mx-auto">日常に潜む100の分岐点。その無意識の選択の重みが、あなたの主義を定義する。</p>
            
            <div class="mb-20">
                <button onclick="window.startDiagnosis()" class="w-full md:w-auto bg-gray-900 text-white px-16 py-6 rounded-full font-bold text-xl shadow-2xl transition active:scale-95">診断を開始する（全100問）</button>
                <div class="mt-8">
                    <button onclick="window.showView('guide')" class="text-[10px] font-bold text-gray-400 hover:text-blue-500 uppercase tracking-widest border-b border-gray-200 hover:border-blue-200 pb-1 transition">初めての方はこちら</button>
                </div>
            </div>

            <div id="intro-toc-area" class="mt-24">
                <h3 class="text-[10px] font-black text-gray-300 uppercase tracking-[0.5em] mb-12 italic">Deep Insight Menu</h3>
                <div class="ism-grid" id="ism-intro-grid"></div>
            </div>
        </div>

        <!-- Deep Dive Sections (Content Volume for AdSense) -->
        <div id="ism-deep-dive" class="w-full border-t border-gray-50">
            <!-- Dynamic Content Injected Here -->
        </div>

        <!-- Guide View -->
        <div id="guide" class="max-w-2xl w-full hidden py-12 px-6">
            <button onclick="window.showView('intro')" class="mb-8 text-gray-400 font-bold text-[10px] uppercase tracking-widest flex items-center gap-2 transition">← BACK</button>
            <div class="bg-white p-8 md:p-12 rounded-[2.5rem] shadow-sm border border-gray-100 text-left">
                <h2 class="text-2xl md:text-4xl font-bold mb-10 serif border-b pb-6 text-center">初めての方へ：PITAの楽しみ方</h2>
                <div class="space-y-10 text-gray-600 text-sm leading-relaxed text-balance text-left">
                    <section>
                        <h3 class="text-xs font-black text-blue-600 uppercase tracking-widest mb-4 border-l-4 border-blue-600 pl-3 text-left">01. 直感に従って回答する</h3>
                        <p>100の質問に対し、深く考えすぎず、直感でパッと答えてください。その瞬間の迷いこそが、あなたの深層心理を映し出す鍵となります。</p>
                    </section>
                    <section>
                        <h3 class="text-xs font-black text-blue-600 uppercase tracking-widest mb-4 border-l-4 border-blue-600 pl-3 text-left">02. 4つの評価軸を理解する</h3>
                        <p>PITAは「社会（利他・利己）」「精神（楽観・虚無）」「思考（理想・現実）」「行動（秩序・混沌）」の4軸で構成されています。それぞれの軸での揺らぎが統合され、あなたの「魂の形」が決定されます。</p>
                    </section>
                    <section class="p-6 bg-slate-50 rounded-2xl border border-slate-100">
                        <h3 class="text-xs font-black text-slate-900 uppercase tracking-widest mb-4 text-left">プライバシーポリシーの確認</h3>
                        <p class="mb-4 text-left">診断を開始する前に、データの取り扱いに関するプライバシーポリシーを必ずご確認ください。本診断を開始した時点で、ポリシーの内容に同意したものとみなされます。</p>
                        <a href="privacy.html" class="text-xs font-bold text-blue-600 border-b border-blue-200 pb-0.5 hover:text-blue-800 transition uppercase tracking-widest">Privacy Policy を確認する</a>
                    </section>
                </div>
                <div class="mt-12 text-center">
                    <button onclick="window.startDiagnosis()" class="bg-gray-900 text-white px-10 py-4 rounded-full font-bold shadow-lg">理解したので診断を始める</button>
                </div>
            </div>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz" class="max-w-2xl w-full hidden py-12 px-6 text-left">
            <div class="adsense-unit">AD UNIT: QUIZ TOP</div>
            <div class="mb-12">
                <div class="w-full bg-gray-100 h-[2px] mb-6"><div id="progress" class="progress-bar bg-blue-600 h-full w-[1%] transition-all"></div></div>
                <div class="flex justify-between items-end">
                    <div class="flex flex-col text-left text-balance">
                        <span id="q-hint" class="text-[10px] font-bold text-blue-500 italic mb-1 h-4 select-none text-left">...</span>
                        <span id="q-count" class="text-[9px] font-black text-gray-400 tracking-widest uppercase text-left">Question 01</span>
                    </div>
                    <div id="q-percent" class="text-3xl md:text-4xl font-light text-blue-600 serif leading-none">1%</div>
                </div>
            </div>
            <div class="min-h-[220px] flex items-center justify-center mb-12 text-center">
                <h3 id="question-text" class="text-xl md:text-3xl font-bold leading-relaxed serif text-gray-800 text-balance"></h3>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-lg mx-auto mb-8">
                <button onclick="window.answer(true)" class="btn-choice py-6 md:py-8 px-6 rounded-2xl font-bold text-lg text-gray-800">はい</button>
                <button onclick="window.answer(false)" class="btn-choice py-6 md:py-8 px-6 rounded-2xl font-bold text-lg text-gray-800">いいえ</button>
            </div>
            <div class="flex flex-col items-center gap-6 mt-4">
                <button id="btn-back" onclick="window.goBack()" class="hidden text-[10px] font-bold uppercase tracking-widest text-gray-400 transition hover:text-black text-center">← 一つ前に戻る</button>
                <button onclick="window.abortToEPH()" class="text-[10px] font-bold text-gray-300 uppercase tracking-widest hover:text-red-400 transition">もう飽きた</button>
            </div>
        </div>

        <!-- Result Screen -->
        <div id="result" class="max-w-4xl w-full hidden fade-in py-12 text-center px-6">
            <div class="text-center mb-16 mx-auto">
                <p class="text-[9px] font-black text-blue-600 uppercase tracking-[0.6em] mb-4 text-center">Diagnostic Complete</p>
                <h2 id="result-title" class="text-4xl md:text-7xl font-bold mb-1 serif tracking-tighter text-gray-900"></h2>
                <p id="result-en" class="text-[12px] font-black text-gray-300 uppercase tracking-[0.4em] mb-6 italic text-center"></p>
                <p id="result-catch" class="text-lg md:text-2xl text-gray-400 font-medium italic serif mb-10 text-center"></p>
                <div id="result-art-container" class="img-slot shadow-2xl bg-white mb-12 border-none scale-105 mx-auto"></div>
                <div class="inline-flex flex-col items-center bg-white px-8 py-6 rounded-[2rem] border border-gray-100 shadow-sm relative mx-auto text-center">
                    <div class="flex items-center gap-2 mb-1">
                        <div class="text-[8px] md:text-[9px] text-gray-400 uppercase font-black tracking-[0.4em]">Deep PITA Index</div>
                        <button onclick="window.toggleIndexModal(true)" class="w-4 h-4 rounded-full bg-gray-100 text-[8px] text-gray-400 flex items-center justify-center hover:bg-blue-500 hover:text-white transition">?</button>
                    </div>
                    <div class="flex items-baseline gap-2 justify-center text-balance">
                        <div id="stat-1" class="text-4xl md:text-6xl font-black italic tracking-tighter text-blue-900 text-center"></div>
                        <div class="text-[10px] font-bold text-gray-300">/ 200.0</div>
                    </div>
                    <button onclick="window.toggleIndexModal(true)" class="mt-4 text-[8px] font-black text-blue-500 uppercase tracking-widest border-b border-blue-100 pb-0.5 hover:text-blue-800 transition">PITA Indexとは何か？ →</button>
                </div>
            </div>

            <div class="space-y-24">
                <div class="animate-bounce"><div class="text-blue-400 text-2xl">▼</div><p class="text-[9px] text-gray-300 mt-2 font-bold uppercase tracking-widest">指標バランス</p></div>
                <section class="max-w-2xl mx-auto px-6 text-center"><h4 class="text-[9px] font-bold text-gray-300 mb-10 uppercase tracking-[0.5em] italic">Spectrum Balance</h4><div id="axis-details" class="space-y-10"></div></section>
                <div class="animate-bounce"><div class="text-blue-400 text-2xl">▼</div><p class="text-[9px] text-gray-300 mt-2 font-bold uppercase tracking-widest">類似した魂</p></div>
                <section class="border-t border-gray-100 pt-20 overflow-hidden text-center"><h4 class="text-[9px] font-bold text-gray-400 mb-8 uppercase tracking-[0.5em] italic text-center">Parallel Souls (Historical)</h4><div id="historical-ticker-area"></div></section>
                <section class="border-t border-gray-100 pt-16 overflow-hidden text-center"><h4 class="text-[9px] font-bold text-blue-400 mb-8 uppercase tracking-[0.5em] italic text-center text-balance">Modern Icons (Characters)</h4><div id="modern-ticker-area"></div></section>
                <div class="animate-bounce"><div class="text-blue-400 text-2xl">▼</div><p class="text-[9px] text-gray-300 mt-2 font-bold uppercase tracking-widest">深層心理の解剖</p></div>
                <section class="bg-white p-8 md:p-24 rounded-[3rem] shadow-sm border border-gray-50 text-left"><h4 class="text-[9px] font-bold text-gray-300 mb-10 uppercase tracking-[0.5em] text-center italic text-left">Identity Report</h4><div id="result-desc" class="leading-relaxed md:leading-[2.8] text-base md:text-xl space-y-12 serif text-gray-700"></div></section>
                <div class="animate-bounce"><div class="text-blue-400 text-2xl">▼</div><p class="text-[9px] text-gray-300 mt-2 font-bold uppercase tracking-widest text-balance text-balance">書籍紹介</p></div>
                <section class="max-w-5xl mx-auto px-6"><h4 class="text-[9px] font-bold text-gray-300 mb-10 uppercase tracking-[0.5em] text-center italic">RECOMMENDED BOOKS</h4><div id="recommended-books" class="grid grid-cols-1 md:grid-cols-3 gap-8 text-left"></div></section>
                <div class="animate-bounce"><div class="text-blue-400 text-2xl">▼</div><p class="text-[9px] text-gray-300 mt-2 font-bold uppercase tracking-widest">今後の指針</p></div>
                <section class="bg-blue-600 text-white p-8 md:p-24 rounded-[3rem] shadow-2xl relative overflow-hidden"><h4 class="text-[9px] font-bold text-blue-200 mb-10 uppercase tracking-[0.6em] text-center">Future Guidance</h4><div id="result-direction" class="text-blue-50 leading-relaxed md:leading-[2.6] text-base md:text-xl space-y-10 relative z-10 mb-12"></div><div class="relative z-10"><a href="https://buy.stripe.com/test_placeholder" target="_blank" class="btn-stripe inline-flex flex-col items-center px-12 py-6 rounded-2xl font-bold shadow-2xl transition hover:scale-105"><span class="text-lg">回答履歴＆詳細分析レポート（PDF版）を購入</span><span class="text-xs opacity-70 mt-1">Stripeで安全に決済 ¥300</span></a></div></section>
                <div class="flex flex-col gap-6 pt-12 text-center pb-24 px-6 mx-auto max-w-sm">
                    <div class="flex gap-3"><button onclick="window.shareOnX()" class="flex-1 bg-[#1DA1F2] text-white py-4 rounded-full font-bold shadow-xl">Xでシェア</button><button onclick="window.shareOnLINE()" class="flex-1 btn-line py-4 rounded-full font-bold shadow-xl text-balance">LINEで送る</button></div>
                    <a href="https://docs.google.com/forms/d/e/1FAIpQLScWb_WefRVtWsWeeXNAJlm3fBFACmuY30riYMUkn6S3gA-ltg/viewform?usp=header" target="_blank" rel="noopener noreferrer" class="btn-secondary text-gray-700 py-5 px-10 rounded-full font-bold text-lg text-center flex items-center justify-center">フィードバックを送る</a>
                    <button onclick="location.reload()" class="bg-[#111111] text-white py-5 px-10 rounded-full font-bold text-lg shadow-md hover:bg-black transition">もう一度診断する</button>
                </div>
                <section class="max-w-xl mx-auto px-6 py-12 text-center text-balance text-balance">
                    <a href="law.html" class="inline-block text-[10px] font-bold text-gray-400 hover:text-blue-500 border-b border-gray-100 pb-1 transition uppercase tracking-[0.2em]">特定商取引法に基づく表記 →</a>
                </section>
            </div>
        </div>
    </main>

    <footer class="p-16 text-center border-t border-gray-50 bg-white">
        <div class="flex flex-wrap justify-center gap-x-8 gap-y-4 mb-12 text-[10px] font-bold text-gray-400 uppercase tracking-widest">
            <button onclick="window.showView('guide')" class="hover:text-blue-500 transition">GUIDE</button>
            <a href="https://docs.google.com/forms/d/e/1FAIpQLScWb_WefRVtWsWeeXNAJlm3fBFACmuY30riYMUkn6S3gA-ltg/viewform?usp=header" target="_blank" rel="noopener noreferrer" class="hover:text-blue-500 transition">CONTACT</a>
            <a href="privacy.html" class="hover:text-blue-500 transition">PRIVACY POLICY</a>
            <a href="law.html" class="hover:text-blue-500 transition">LEGAL NOTICE</a>
        </div>
        <p class="text-[9px] text-gray-300 uppercase tracking-[0.4em] font-bold text-center">
            &copy; 2026 pita-diagnosis.com. All rights reserved.
        </p>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";

        const firebaseConfig = {
          apiKey: "AIzaSyD0udBkcLXL7R2UrToqXJL9O12mpoQzf6E",
          authDomain: "pita-diagnosis.firebaseapp.com",
          projectId: "pita-diagnosis",
          storageBucket: "pita-diagnosis.firebasestorage.app",
          messagingSenderId: "209455556506",
          appId: "1:209455556506:web:2f2ca38ef8a34f1f76fc23",
          measurementId: "G-C9589BVH5M"
        };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const amazonId = "pitadiagnosis-22";

        const allIsmContent = [
            {
                id: "alt", n: "利他主義者", en: "ALTRUIST", img: "PITA-ALT.png", c: "「時代を救済する慈愛の聖者」",
                actDesc: "自分の得よりも「誰かが助かること」を優先します。誰も見ていない場所でゴミを拾ったり、誰かのミスをこっそり直したりすることに、静かな喜びを感じます。感謝されることすら、相手に気を使わせたと申し訳なく思うほど、その優しさは純粋です。",
                abyDesc: "自分という存在を完全に消し去り、ただ誰かのためだけに動く「機能」となります。自らを削ることに痛みを感じないその姿は、危うくも美しい聖性を帯びます。"
            },
            {
                id: "ego", n: "利己主義者", en: "EGOIST", img: "PITA-EGO.png", c: "「自己を統治する気高き孤高の王」",
                actDesc: "自分の時間と幸せを何よりも大切にします。気が進まない誘いは迷わず断り、他人の期待よりも「自分がどうしたいか」を優先します。自分を裏切らないその生き方は、周囲に流されない強固な自立心に基づいています。",
                abyDesc: "世界に自分一人しか存在しないかのように振る舞い、他者を自分の目的のための風景として扱います。誰にも依存せず、誰の助けも借りない、孤独で圧倒的な王の領域です。"
            },
            {
                id: "opt", n: "楽観主義者", en: "OPTIMIST", img: "PITA-OPT.png", c: "「世界に光を灯す不滅の希望」",
                actDesc: "どんなトラブルも「なんとかなる」と笑い飛ばせます。失敗を反省するより「次はもっと良くなる」と信じ、常に明るい未来をイメージしています。そのポジティブな波動は、周囲の不安を消し去る力を持っています。",
                abyDesc: "どんな悲劇や破滅すらも「祝福」として笑顔で受け入れます。現実の危機感すらも希望の色で塗りつぶした、圧倒的な光の領域に達します。"
            },
            {
                id: "nih", n: "虚無主義者", en: "NIHILIST", img: "PITA-NIH.png", c: "「真理を悟りし超越の静観者」",
                actDesc: "流行や他人の評価に惑わされません。「どうせすべては消えゆくもの」という視点から、物事に過度な期待をせず、淡々と日々を過ごします。何が起きても動じない、凪のような心の静寂を持っています。",
                abyDesc: "生きる意味や感情さえも手放し、ただ世界が移ろいゆくのを眺めるだけの存在となります。人間らしい熱を完全に失ったその瞳は、宇宙の静寂そのものです。"
            },
            {
                id: "ide", n: "理想主義者", en: "IDEALIST", img: "PITA-IDE.png", c: "「至高なる未来を紡ぐ美の建築家」",
                actDesc: "損得よりも「それが正しいか、美しいか」を信じます。現実がどれほど厳しくても、心の中にある「理想の星」を見失いません。現状に妥協せず、あるべき姿を追い求める情熱を持っています。",
                abyDesc: "自分の理想こそが唯一の正解だと信じ、それに従わない現実世界を否定し始めます。理想を叶えるためなら、すべてを焼き払うことも厭わない、燃えるような魂の極地です。"
            },
            {
                id: "rea", n: "現実主義者", en: "REALIST", img: "PITA-REA.png", c: "「混沌を切り裂く真実の体現者」",
                actDesc: "感情論ではなく、事実と論理で物事を判断します。夢物語よりも、確実に成果が出るデータや効率を重視します。「今、ここで何ができるか」を冷静に積み上げ、着実に足場を固めていく実力者です。",
                abyDesc: "人生のすべてを数値化し、友情や愛情すらもコストとリターンで評価します。感情という不確かなノイズを排除した、冷徹なシステムの体現者となります。"
            },
            {
                id: "mod", n: "秩序主義者", en: "MODERATOR", img: "PITA-MOD.png", c: "「調和を維持する世界の守護者」",
                actDesc: "決まったルールやルーティンに安らぎを感じます。整理整頓を欠かさず、マナーを厳格に守るその姿は、社会の安定を支える要石です。予測不能な事態を避けるための準備に誇りを持っています。",
                abyDesc: "わずかな乱れも許せなくなり、完璧にコントロールされた変化のない世界に閉じこもります。変化を悪とみなし、永遠の安定を求め続ける静止した存在へと化します。"
            },
            {
                id: "ana", n: "混沌主義者", en: "ANARCHIST", img: "PITA-ANA.png", c: "「無限の可能性を解き放つ自由の解放者」",
                actDesc: "予定に縛られることを嫌い、その瞬間の直感で動きます。安定した地位を捨てて新しい挑戦を始めたり、既存のルールを壊したりすることに生の実感を見出します。刺激と変化を愛する、真の自由人です。",
                abyDesc: "自分が築き上げた信頼や財産すらも、退屈という理由で破壊し尽くします。一箇所に留まることができず、嵐のようにすべてをなぎ倒して進む、破壊的自由の化身です。"
            }
        ];

        const qL = [
            {n:1, t:"レジの会計。後ろに人が並んでいるとき、小銭で支払いたくても、お札やカードなど時間のかからない方法を選んでしまう。", a:"ALT", w:2},
            {n:2, t:"他人の失敗談を聞くと、口では同情しながらどこか「安心」を感じるほうだ。", a:"EGO", w:1},
            {n:3, t:"グループの空気が悪いとき、自分がピエロになってでも場を和ませる努力をする。", a:"ALT", w:2},
            {n:4, t:"自分を犠牲にしてまで守るべきものを長時間考えても、ひとつも思いつかない。", a:"EGO", w:4},
            {n:5, t:"電車で席を譲る際、「誰かに見られているのではないか」と自意識が過剰に働く。", a:"EGO", w:2},
            {n:6, t:"SNSで誰かが炎上していると詳細を積極的に追う", a:"EGO", w:1},
            {n:7, t:"友人の恋人ができた報告を聞くと、お祝いの前に「焦り」や「対抗心」が芽生える。", a:"EGO", w:1},
            {n:8, t:"チームの勝利よりも、自分自身の成果を重視する。", a:"EGO", w:2},
            {n:9, t:"道に迷っている人を見かけたら、積極的に声をかけようとする。", a:"ALT", w:2},
            {n:10, t:"悩み相談。解決策を提示するより、ただ相手の気持ちに深く寄り添う。", a:"ALT", w:3},
            {n:11, t:"自分が損をしても、周囲が幸せならそれでいい。", a:"ALT", w:4},
            {n:12, t:"嫌いな相手が苦境に立たされているのを知ると、密かに喜びを感じる。", a:"EGO", w:3},
            {n:13, t:"対立を避けるためなら、自分の本当の意見を飲み込む選択をする。", a:"ALT", w:1},
            {n:14, t:"飲み会で他人の話を聞くくらいなら、家で一人でご飯を食べる方が有意義だ", a:"EGO", w:1},
            {n:15, t:"誰かに「ありがとう」と言われても、嬉しさより気を使わせてしまったという申し訳なさが勝る。。", a:"ALT", w:3},
            {n:16, t:"匿名掲示板やSNSで、誰かの落ち度を厳しく指摘した経験がある。", a:"EGO", w:3},
            {n:17, t:"相手が喜ぶ姿を想像しながら、お土産を真剣に選ぶことが好きだ。", a:"ALT", w:1},
            {n:18, t:"行列でマナーの悪い人を見ても、トラブルを起こさないため見て見ぬふりをする。", a:"ALT", w:1},
            {n:19, t:"公共の場で騒いでいる子供を、親のしつけ不足だと思う。", a:"EGO", w:2},
            {n:20, t:"一番親しい友人が借金で困っていたら、返ってこない覚悟でお金を貸す。", a:"ALT", w:3},
            {n:21, t:"自分のミスを他人のせいにできる状況なら、そうする。", a:"EGO", w:3},
            {n:22, t:"SNSの「いいね」の数は、自分の価値を証明する尺度だ。", a:"EGO", w:1},
            {n:23, t:"少し前を歩いている人がハンカチを落としたら、急いで拾って追いかける。", a:"ALT", w:2},
            {n:24, t:"限定商品の最後の一個を見つけた時、周囲に他のお客さんがいないか確認せずに即座に手に取る", a:"EGO", w:2},
            {n:25, t:"他人の顔色を伺って、自分の発言を微調整することが日常的だ。", a:"ALT", w:1},
            {n:26, t:"寝る前、明日の予定を考えるとワクワクして眠れないことがある。", a:"OPT", w:1},
            {n:27, t:"成功者の体験談を読むと、成功は単なる運だと思う。", a:"NIH", w:1},
            {n:28, t:"100円の宝くじで、1億円が当たったら何に使うか想像して楽しむタイプだ。", a:"OPT", w:2},
            {n:29, t:"どんなに努力しても、生まれ持った才能の壁は超えられない。", a:"NIH", w:3},
            {n:30, t:"自然災害や凄惨な事件のニュースを見ても、どこか他人事のように感じる。", a:"NIH", w:2},
            {n:31, t:"「人生は一度きり」という言葉に、希望よりも重圧を感じる。", a:"NIH", w:2},
            {n:32, t:"自分が死んだ後の世界がどうなっていようが、別にどうでもよい。", a:"NIH", w:2},
            {n:33, t:"映画の感動的なシーンを見ても、「これは観客を泣かせるための演出だな」と冷静に分析してしまう。", a:"NIH", w:1},
            {n:34, t:"失敗したときは「今回は運が悪かった、次は大丈夫」と思う。", a:"OPT", w:3},
            {n:35, t:"初対面の人と接して、「いい人だ」とよく思う。", a:"OPT", w:2},
            {n:36, t:"ゲームや目標をやり遂げた直後、充実感よりも「で、これが何になるんだ？」という虚しさが勝る。", a:"NIH", w:3},
            {n:37, t:"ブランド物の服や、靴、アクセサリー、バッグを見ても、価値を感じず、「なぜこんなものにこんな値段がつくのか」と疑問に思う。", a:"NIH", w:2},
            {n:38, t:"新しいことに挑戦する時、成功した時の報酬を常に先に考えて行動する。", a:"OPT", w:2},
            {n:39, t:"過去の失敗は、すべて今の自分にとって必要不可欠なことだった。", a:"OPT", w:2},
            {n:40, t:"自分には、まだ誰にも見せていない特別な才能が眠っていると思っている。", a:"OPT", w:2},
            {n:41, t:"ネットの悲観的な意見が、自分の不安を代弁していると感じる。", a:"NIH", w:1},
            {n:42, t:"賑やかなパーティーや飲み会で、自分だけが透明人間になって眺めているような感覚になる。", a:"NIH", w:1},
            {n:43, t:"誰かが熱く夢を語っているのを見ると、「痛々しさ」を感じてしまう", a:"NIH", w:1},
            {n:44, t:"「努力は必ず報われる」という言葉は正しいと思う。", a:"OPT", w:3},
            {n:45, t:"人生において「意味」を探す行為は、時間の無駄である。", a:"NIH", w:3},
            {n:46, t:"どん底の状況でも、「ここから逆転したら面白いことになるぞ」と楽しめる余裕がある。", a:"OPT", w:3},
            {n:47, t:"「自分探し」をしている人を見ると、存在しないものを探しているようで滑稽に思える", a:"NIH", w:1},
            {n:48, t:"道端に咲く花を見て、生命の力強さに感動する。", a:"OPT", w:2},
            {n:49, t:"いつか人類は滅亡するため、いま人間がやっていることはすべて無意味である。", a:"NIH", w:4},
            {n:50, t:"もし生まれ変わるなら、また「自分自身」に生まれたいと思う。", a:"OPT", w:4},
            {n:51, t:"映画や小説を楽しむ前に、あらすじや結末が気になって調べてしまう。", a:"REA", w:1},
            {n:52, t:"「愛があればお金はいらない」という言葉の意味が正直わかっていない。", a:"REA", w:3},
            {n:53, t:"行列ができる人気店でも、待ち時間が1時間を超えるなら、すぐに空いている隣の店に入る。", a:"REA", w:2},
            {n:54, t:"自分の部屋や持ち物、服装には、他人には理解されない独自の「こだわり」が詰まっている。", a:"IDE", w:2},
            {n:55, t:"目的地へ向かう時、最短ルートで行くよりも、あえて遠回りしてでも「景色が良い道」を歩きたい。", a:"IDE", w:1},
            {n:56, t:"スペックの数値よりも、直感的に「好きだ」と思ったデザインで買う物を決める。", a:"IDE", w:1},
            {n:57, t:"直感や占いよりも、客観的なデータや検索結果を信頼する。", a:"REA", w:2},
            {n:58, t:"映画や小説を見る時、結末が「ハッピーエンド」でないと、見たことを後悔する", a:"IDE", w:2},
            {n:59, t:"欲しいものを語るよりも、今月、自分が何に何円使ったかを把握したい。", a:"REA", w:2},
            {n:60, t:"自分の意見に対して正論を言われると、悔しい気持ちになるが、それでも自分は間違ってないと思う。", a:"IDE", w:3},
            {n:61, t:"お金と時間があるなら、自分の「ロマン」を突き詰めたい。", a:"IDE", w:1},
            {n:62, t:"ネット上の口コミや評価スコアは、自分の主観よりも信頼できる判断材料だ。", a:"REA", w:1},
            {n:63, t:"自分にしか見えていない「世界の真理」が存在すると密かに信じている。", a:"IDE", w:3},
            {n:64, t:"仕事や勉強において、「頑張り」などの過程よりも、最終的な「結果」のほうが重要だと思う。", a:"REA", w:3},
            {n:65, t:"新しいアプリや機械を使う時、説明書を読まずに、自分の力でやろうとする。", a:"IDE", w:2},
            {n:66, t:"「普通はこうする」という世間の常識を、自分らしさを殺すための言葉のように感じる。", a:"IDE", w:3},
            {n:67, t:"旅行は計画を完璧に立て、実際に行くときはその予定に忠実に動く。", a:"REA", w:2},
            {n:68, t:"結婚相手を選ぶなら、性格の相性や愛情よりも、年収や職業などの「生活基盤の安定」を何より重視すべきだ。", a:"REA", w:3},
            {n:69, t:"会議中や授業中に空想にふけって、話がどこまで進んでいるかが分からなくなってしまう。", a:"IDE", w:2},
            {n:70, t:"芸術作品を金を払って買う人の気持ちが分からず、そのお金で美味しいものを食べた方がマシだと思う。", a:"REA", w:1},
            {n:71, t:"この世に「運命」はなく、すべては数字と確率で説明できるものだ。", a:"REA", w:4},
            {n:72, t:"劇的な出会いや運命的な出来事が、自分の人生にもいつか必ず起こると信じている。", a:"IDE", w:4},
            {n:73, t:"素晴らしい製品の開発秘話を語るTV番組があったら、つい見てしまう", a:"IDE", w:2},
            {n:74, t:"投資やギャンブルをする際、勝つ確率が80%あったとしても、20%の負けるリスクが気になって手が出せない。", a:"REA", w:1},
            {n:75, t:"趣味を始める時、「将来の仕事やスキルアップに役立つか」という実利を考えてしまう。", a:"REA", w:2},
            {n:76, t:"スマホの充電が 30% を切ると、落ち着かなくなり充電器を探す。", a:"MOD", w:1},
            {n:77, t:"予定がない休日でも、何時に起きるかを前日に決めてアラームをかけてから眠る。", a:"MOD", w:2},
            {n:78, t:"他人の靴が揃っていないのを見ると、直したくなる。", a:"MOD", w:1},
            {n:79, t:"旅行中に計画が崩れるようなトラブルが起きても、「これも旅の醍醐味だ」と笑って楽しめる。", a:"ANA", w:2},
            {n:80, t:"自分の葬式は、従来の宗教的・形式的な儀礼を一切排除したい。", a:"ANA", w:3},
            {n:81, t:"毎日同じ時間に起き、同じルーティンをこなす生活に、退屈さを感じる", a:"ANA", w:3},
            {n:82, t:"整理整頓が完璧な空間よりも、少し生活感のある空間のほうが好きだ。", a:"ANA", w:2},
            {n:83, t:"PCやスマホのアイコンやファイルは、常にフォルダ分けして整理されている。", a:"MOD", w:3},
            {n:84, t:"「締め切り」という束縛を感じると、すべてを放り出して逃げたくなる。", a:"ANA", w:2},
            {n:85, t:"初めての場所へ行く時、あえて地図を見ずに直感だけで歩くことが好きだ。", a:"ANA", w:1},
            {n:86, t:"深夜の赤信号。車が1台も来ないと分かっていても、青に変わるまで律儀に待ち続ける。", a:"MOD", w:1},
            {n:87, t:"明確なルールがあるからこそ、その中で「自由」を満喫できるのだと信じている。", a:"MOD", w:4},
            {n:88, t:"新しいお店に入る時、事前にSNSやネットで内装やメニュー、価格帯を調べてから入る。", a:"MOD", w:1},
            {n:89, t:"「まず準備する」方が「とりあえずやってみる」より、最終的な効率が良いと考える。", a:"MOD", w:1},
            {n:90, t:"カフェや電車で、空いていれば「お気に入りの特定の席」をいつも選んでしまう。", a:"MOD", w:1},
            {n:91, t:"予測不可能な行動をとって、周囲の反応を伺うことが好きだ。", a:"ANA", w:1},
            {n:92, t:"指示されることを、自分の尊厳に対する侵害だと感じる。", a:"ANA", w:3},
            {n:93, t:"ゴミの分別が適当な人に対し、強い嫌悪感を抱く。", a:"MOD", w:1},
            {n:94, t:"予定が埋まっているカレンダーを見ると、息苦しさを感じる。", a:"ANA", w:2},
            {n:95, t:"行列の並び方がバラバラだったり、ルールを守らない人がいたりすると、注意したくてたまらなくなる。", a:"MOD", w:3},
            {n:96, t:"「マニュアル通り」に進めることは、手抜きではなく、最も誠実で効率的な方法だと思う", a:"MOD", w:3},
            {n:97, t:"「常識外れ」や「空気が読めない」、「変人」と言われることは、自分にとって褒め言葉に近い。", a:"ANA", w:2},
            {n:98, t:"カバンの中身が常に整理されており、どこになにが入っているか把握している。", a:"MOD", w:2},
            {n:99, t:"他人の「5分程度の遅刻」が、どうしても許しがたい不誠実だと感じる。", a:"MOD", w:1},
            {n:100, t:"今、この瞬間に, 名前も, 経歴も, 人間関係も全て失い, 別の人生を始められるのなら, そうする。", a:"ANA", w:4}
        ];

        let cur=0,scr={ALT:0,EGO:0,OPT:0,NIH:0,IDE:0,REA:0,MOD:0,ANA:0},hst=[],ans=[],fT='';
        let startTime = Date.now();
        let backCounts = new Array(101).fill(0);

        window.renderDeepDive = () => {
            const container = document.getElementById('ism-deep-dive');
            container.innerHTML = '';
            allIsmContent.forEach((ism, index) => {
                const bgColor = index % 2 === 0 ? 'bg-white' : 'bg-[#fafafa]';
                container.innerHTML += `
                <section id="ism-${ism.id}" class="${bgColor} py-24 px-6 border-b border-gray-50">
                    <div class="max-w-4xl mx-auto">
                        <div class="text-center mb-16">
                            <div class="img-slot w-32 h-32 md:w-40 md:h-40 mb-6 shadow-2xl mx-auto border-none">
                                <img src="${ism.img}" class="result-img opacity-100">
                            </div>
                            <p class="text-[12px] font-black text-blue-600 uppercase tracking-[0.4em] mb-2">${ism.en}</p>
                            <h2 class="text-3xl md:text-5xl font-bold mb-6 serif tracking-tighter text-gray-900">${ism.n}</h2>
                            <p class="text-base md:text-xl text-gray-400 font-medium italic serif mb-10">${ism.c}</p>
                        </div>
                        <div class="space-y-12 max-w-3xl mx-auto text-left">
                            <div class="bg-white p-8 md:p-12 rounded-[2.5rem] border border-gray-100 shadow-sm">
                                <h4 class="text-[10px] font-bold text-blue-600 mb-6 uppercase tracking-[0.4em] border-l-4 border-blue-600 pl-3">日常の行動原理</h4>
                                <p class="text-gray-700 leading-relaxed text-sm md:text-base font-medium serif">${ism.actDesc}</p>
                            </div>
                            <div class="bg-blue-600 text-white p-8 md:p-12 rounded-[2.5rem] shadow-2xl relative overflow-hidden">
                                <h4 class="text-[10px] font-bold text-blue-200 mb-6 uppercase tracking-[0.4em] border-l-4 border-blue-400 pl-3 relative z-10">思想の深淵</h4>
                                <p class="text-blue-50 leading-relaxed text-sm md:text-base font-medium relative z-10 serif">${ism.abyDesc}</p>
                            </div>
                        </div>
                        <div class="mt-12 text-center">
                            <a href="#intro" class="text-[10px] font-bold text-gray-300 hover:text-blue-500 uppercase tracking-widest transition">↑ BACK TO TOP</a>
                        </div>
                    </div>
                </section>
                <div class="adsense-unit">AD UNIT: SECTION DIVIDER</div>
                `;
            });
        };

        window.initIntroIsmList=()=>{
            const c=document.getElementById('ism-intro-grid');if(!c)return;c.innerHTML='';
            ['ALT','EGO','OPT','NIH','IDE','REA','MOD','ANA'].forEach(k=>{
                const ism = allIsmContent.find(i => i.en.startsWith(k));
                c.innerHTML+=`<a href="#ism-${ism.id}" class="ism-card"><div class="img-slot w-12 h-12 mb-3 mx-auto flex items-center justify-center overflow-hidden"><img src="${ism.img}" class="list-img" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'"><div style="display:none" class="w-full h-full items-center justify-center text-[8px] text-gray-300 font-black">${k}</div></div><div class="text-[10px] font-black">${ism.n}</div><div class="text-[8px] font-bold text-blue-500 italic">(${ism.en})</div></a>`;
            });
        };

        window.toggleIndexModal=(s)=>{const m=document.getElementById('index-modal');m.classList.toggle('hidden',!s);document.body.style.overflow=s?'hidden':'auto';};
        window.closeIndexModal=(e)=>{if(e.target.id==='index-modal')window.toggleIndexModal(false);};
        window.startDiagnosis=()=>{cur=0;scr={ALT:0,EGO:0,OPT:0,NIH:0,IDE:0,REA:0,MOD:0,ANA:0};hst=[];ans=[];fT='';startTime=Date.now();window.showView('quiz');showQ();};
        window.answer=async(isYes)=>{
            const q=qL[cur];
            const timeSpent = ((Date.now() - startTime) / 1000).toFixed(2);
            hst.push({scr:JSON.parse(JSON.stringify(scr)),idx:cur});
            ans[cur] = { n: cur + 1, q: q.t, s: q.a, w: q.w, a: isYes ? "はい" : "いいえ", t: timeSpent, b: backCounts[cur] };
            const m={ALT:'EGO',EGO:'ALT',OPT:'NIH',NIH:'OPT',IDE:'REA',REA:'IDE',MOD:'ANA',ANA:'MOD'};
            if(isYes)scr[q.a]+=q.w;else scr[m[q.a]]+=q.w;
            cur++;if(cur<100) { startTime = Date.now(); showQ(); } else finish();
        };
        window.goBack=()=>{
            if(hst.length===0)return;
            const s=hst.pop();scr=s.scr;cur=s.idx;backCounts[cur]++;startTime = Date.now();showQ();
        };
        window.abortToEPH=()=>{fT='EPH';finish();};
        window.showView=(v)=>{['intro','guide','quiz','result'].forEach(x=>{const el=document.getElementById(x);if(el)el.classList.toggle('hidden',x!==v);});window.scrollTo(0,0);};
        window.devClick=()=>{window.dc=(window.dc||0)+1;if(window.dc>=5){document.getElementById('dev-menu').classList.remove('hidden');window.dc=0;}};
        window.jumpToResult=(t)=>{fT=t;document.getElementById('dev-menu').classList.add('hidden');finish();};
        
        function showQ(){
            const q=qL[cur],p=((cur+1)/100)*100;
            document.getElementById('question-text').innerText=q.t;
            document.getElementById('progress').style.width=p+'%';
            document.getElementById('q-count').innerText='Question '+(cur+1).toString().padStart(2,'0');
            document.getElementById('q-percent').innerText=Math.round(p)+'%';
            document.getElementById('q-hint').innerText=hintPool[Math.floor(Math.random()*hintPool.length)];
            document.getElementById('btn-back').classList.toggle('hidden',cur===0);
        }
        async function finish(){
            window.showView('result');if(!fT){let max=-1;Object.keys(scr).forEach(k=>{if(scr[k]>=max){max=scr[k];fT=k;}})}
            const d=resultData[fT];
            document.getElementById('result-title').innerText=d.n;
            document.getElementById('result-en').innerText=d.en;
            document.getElementById('result-catch').innerText=d.c;
            document.getElementById('result-desc').innerHTML=d.d.split('【').filter(s=>s).map(s=>`<div class="mb-12 text-left"><span class="block font-black text-blue-600 text-lg mb-4 text-balance">【${s.split('】')[0]}】</span><p class="pl-4 border-l-4 border-blue-50 text-gray-700 text-balance">${s.split('】')[1]}</p></div>`).join('');
            document.getElementById('recommended-books').innerHTML=d.books.map(b=>`<div onclick="window.open('https://www.amazon.co.jp/s?k=${encodeURIComponent(b.title+'+'+b.author)}&tag=${amazonId}','_blank','noopener,noreferrer')" class="book-card p-8 cursor-pointer text-left"><div class="text-[9px] font-black text-blue-500 uppercase mb-2">Recommended</div><div class="text-base font-bold mb-1">${b.title}</div><div class="text-[11px] text-gray-400 font-bold mb-4">${b.author}</div><p class="text-[12px] text-gray-500 mb-6 text-balance">${b.desc}</p><div class="text-[10px] text-gray-300 font-black border-t pt-4">Amazonで見る →</div></div>`).join('');
            document.getElementById('result-direction').innerHTML=d.dir.split('✦').filter(s=>s).map(s=>`<div class="mb-10 mx-auto max-w-lg text-center text-balance"><span class="block font-black text-blue-100 text-lg mb-3 text-balance">✦【${s.split('】')[0].replace('【','')}】</span><p class="text-blue-50 opacity-90 text-balance">${s.split('】')[1]}</p></div>`).join('');
            
            let idxVal = 0;
            if (fT === 'NIH') idxVal = 100.0;
            else {
                const getP = (l, r) => Math.abs(scr[l] - scr[r]) / ((scr[l] + scr[r]) || 1);
                const pAvg = (getP('ALT', 'EGO') + getP('OPT', 'NIH') + getP('IDE', 'REA') + getP('MOD', 'ANA')) / 4;
                idxVal = 100 + (pAvg * 100);
            }
            document.getElementById('stat-1').innerText = (fT === 'EPH' ? 77.7 : idxVal).toFixed(1);
            document.getElementById('result-art-container').innerHTML=`<img src="${d.img}" class="result-img" onload="this.parentElement.classList.add('img-loaded')" onerror="this.parentElement.innerHTML='<span class=\'text-gray-200\'>${fT}</span>'">`;
            
            const row=(l,isC)=>`<div class="ticker-container"><div class="ticker-row text-balance">${l.map(x=>`<span class="ticker-item ${isC?'ticker-char':''}">${x}</span>`).join('')}${l.map(x=>`<span class="ticker-item ${isC?'ticker-char':''}">${x}</span>`).join('')}</div></div>`;
            const hA = document.getElementById('historical-ticker-area'), mA = document.getElementById('modern-ticker-area');
            if (fT === 'EPH') {
                const qH = ["HISTORIES ARE NOT WRITTEN BY THOSE WHO CANNOT ENDURE THE WEIGHT OF TIME. "], qC = ["A STORY WITHOUT CONTINUITY IS MERELY AN ECHO IN AN EMPTY ROOM. "];
                hA.innerHTML = row(new Array(5).fill(qH[0]), false); mA.innerHTML = row(new Array(5).fill(qC[0]), true);
            } else { hA.innerHTML = row(d.celebs || [], false); mA.innerHTML = row(d.chars || [], true); }

            const ax=document.getElementById('axis-details');ax.innerHTML='';
            [{l:"献身",r:"孤高",lk:'ALT',rk:'EGO'},{l:"渇望",r:"静観",lk:'OPT',rk:'NIH'},{l:"夢幻",r:"実利",lk:'IDE',rk:'REA'},{l:"調和",r:"変革",lk:'MOD',rk:'ANA'}].forEach(p=>{
                const sum=(scr[p.lk]||0)+(scr[p.rk]||0),lp=sum===0?50:Math.round((scr[p.lk]/sum)*100),rp=100-lp;
                ax.innerHTML+=`<div class="space-y-4 text-center text-balance text-balance text-balance text-balance text-balance"><div class="flex justify-between text-[10px] font-black text-gray-400 uppercase italic"><span>${p.l} ${lp}%</span><span>${rp}% ${p.r}</span></div><div class="h-1.5 w-full bg-gray-100 rounded-full flex overflow-hidden text-balance text-balance text-balance text-balance text-balance"><div class="bg-blue-400 h-full" style="width:${lp}%"></div><div class="bg-gray-800 h-full" style="width:${rp}%"></div></div></div>`;
            });
            
            signInAnonymously(auth).then(() => {
                if(auth.currentUser) {
                    setDoc(doc(db, 'artifacts', 'pita', 'users', auth.currentUser.uid, 'userData', 'answers'), {
                        ans: ans, fT: fT, index: idxVal.toFixed(1), finishedAt: serverTimestamp()
                    }).catch(e => console.error("Data Save Failed", e));
                }
            });
        }
        window.shareOnX=()=>{const t=encodeURIComponent(`PITA診断結果：私は【${resultData[fT].n}】でした。PITA Index: ${document.getElementById('stat-1').innerText} / 200.0\n${resultData[fT].c}\n#PITA診断\n`);window.open(`https://twitter.com/intent/tweet?text=${t}&url=${encodeURIComponent(location.href)}`,'_blank');};
        window.shareOnLINE=()=>{const t=encodeURIComponent(`PITA診断結果：私は【${resultData[fT].n}】でした。${resultData[fT].c}\n#PITA診断`);window.open(`https://social-plugins.line.me/lineit/share?url=${encodeURIComponent(location.href)}&text=${t}`,'_blank');};
        
        window.onload = () => {
            window.initIntroIsmList();
            window.renderDeepDive();
        };
    </script>
</body>
</html>
