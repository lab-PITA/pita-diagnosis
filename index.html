<!DOCTYPE html>
<html lang="ja">
<head>
    <!-- Global site tag (gtag.js) - Google Analytics - DO NOT REMOVE -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JL8DFLM6C5"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-JL8DFLM6C5');
    </script>

    <!-- Google AdSense - DO NOT REMOVE -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8425980752738373" crossorigin="anonymous"></script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>PITA診断 | あなたは何主義者として生きるのか。</title>
    <meta name="description" content="100の質問があなたの魂の形を決定づける。深層に潜む『イズム』を解剖する精密診断システム。">
    
    <!-- OGP Settings -->
    <meta property="og:title" content="PITA診断 | あなたは何主義者として生きるのか">
    <meta property="og:description" content="100の質問であなたの深層心理を解剖。魂の形を特定せよ。">
    <meta property="og:image" content="https://pita-diagnosis.com/ogp-image.png">
    <meta property="og:url" content="https://pita-diagnosis.com/">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">

    <link rel="canonical" href="https://pita-diagnosis.com/">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@700&family=Noto+Sans+JP:wght@300;400;700&display=swap" rel="stylesheet">
    
    <style>
        :root { --primary: #111111; --accent: #3b82f6; --bg-gray: #f3f4f6; }
        body { font-family: 'Noto Sans JP', sans-serif; background-color: #ffffff; color: var(--primary); -webkit-font-smoothing: antialiased; overflow-x: hidden; word-break: break-word; }
        .serif { font-family: 'Noto Serif JP', serif; }
        
        .btn-choice { transition: all 0.2s ease-out; border: 1px solid #eeeeee; background: #ffffff; cursor: pointer; -webkit-tap-highlight-color: transparent; }
        .btn-choice:hover { border-color: var(--accent); background: #fafdff; transform: translateY(-1px); }
        .btn-choice:active { transform: scale(0.98); background: #f9f9f9; }
        
        .btn-secondary { transition: all 0.2s; border: 1px solid #e5e7eb; background: #fff; }
        .btn-secondary:hover { border-color: var(--accent); color: var(--accent); }

        .btn-stripe { background: #635bff; color: white; transition: all 0.2s; }
        .btn-stripe:hover { background: #5247e5; transform: translateY(-1px); }
        .btn-line { background: #06C755; color: white; }

        .progress-bar { transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .img-slot { aspect-ratio: 1 / 1; width: 100%; max-width: 320px; margin: 0 auto; border-radius: 50%; background-color: var(--bg-gray); overflow: hidden; display: flex; align-items: center; justify-content: center; position: relative; border: 1px solid #eeeeee; }
        
        .result-img { opacity: 0; transition: opacity 1.2s ease-in-out; width: 100%; height: 100%; object-fit: cover; }
        .img-loaded .result-img { opacity: 1; }

        /* Perfect Seamless Ticker - Train LED Style - Accelerated 40s */
        .ticker-container { width: 100%; overflow: hidden; white-space: nowrap; background: #fafafa; padding: 14px 0; border-top: 1px solid #eee; border-bottom: 1px solid #eee; margin-bottom: 2px; }
        .ticker-row { display: inline-flex; animation: ticker-scroll 40s linear infinite; will-change: transform; }
        @keyframes ticker-scroll { 
            0% { transform: translateX(0); } 
            100% { transform: translateX(-50%); } 
        }
        .ticker-item { display: inline-block; margin: 0 40px; font-weight: 700; color: #888; font-size: 0.95rem; flex-shrink: 0; }
        .ticker-char { color: var(--accent); opacity: 0.8; }

        .hidden { display: none; }
        .fade-in { animation: fadeIn 1s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        .text-balance { text-wrap: balance; }

        #dev-menu { position: fixed; top: 10%; left: 50%; transform: translateX(-50%); width: 90%; max-width: 400px; background: #111; color: white; padding: 2rem; border-radius: 1.5rem; z-index: 1000; box-shadow: 0 20px 50px rgba(0,0,0,0.5); border: 1px solid #333; }
        
        .book-card { transition: all 0.3s; border: 1px solid #f0f0f0; background: #fff; border-radius: 2rem; overflow: hidden; cursor: pointer; }
        .book-card:hover { border-color: var(--accent); transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.05); }

        .scroll-indicator { animation: bounce 2s infinite; }
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% { transform: translateY(0); } 40% { transform: translateY(-10px); } 60% { transform: translateY(-5px); } }
    </style>
</head>
<body class="min-h-screen flex flex-col bg-white text-left">

    <!-- Header -->
    <nav class="p-4 md:p-8 flex justify-between items-center border-b border-gray-50 bg-white/80 backdrop-blur-md sticky top-0 z-50 text-balance">
        <div class="flex flex-col cursor-pointer select-none text-left" onclick="window.devClick()">
            <div class="text-2xl md:text-3xl font-black tracking-tighter serif text-gray-900 leading-none text-left">PITA</div>
            <div class="text-[7px] md:text-[8px] font-bold text-gray-400 tracking-[0.15em] uppercase mt-1 leading-none text-left text-balance">Personality Ism Type Analyzer</div>
        </div>
        <div class="text-[9px] font-bold text-blue-600 tracking-widest uppercase italic border-l pl-4 border-gray-100 text-right">Core v9.5</div>
    </nav>

    <!-- Developer Menu -->
    <div id="dev-menu" class="hidden text-white">
        <p class="mb-4 font-bold border-b border-gray-700 pb-2 text-blue-400 uppercase text-xs text-center">Debug Preview</p>
        <div class="grid grid-cols-2 gap-2 text-center text-xs text-white">
            <button onclick="window.jumpToResult('ALT')" class="p-2 bg-gray-800 rounded">利他主義者</button>
            <button onclick="window.jumpToResult('EGO')" class="p-2 bg-gray-800 rounded">利己主義者</button>
            <button onclick="window.jumpToResult('OPT')" class="p-2 bg-gray-800 rounded">楽観主義者</button>
            <button onclick="window.jumpToResult('NIH')" class="p-2 bg-gray-800 rounded">虚無主義者</button>
            <button onclick="window.jumpToResult('IDE')" class="p-2 bg-gray-800 rounded">理想主義者</button>
            <button onclick="window.jumpToResult('REA')" class="p-2 bg-gray-800 rounded">現実主義者</button>
            <button onclick="window.jumpToResult('MOD')" class="p-2 bg-gray-800 rounded">秩序主義者</button>
            <button onclick="window.jumpToResult('ANA')" class="p-2 bg-gray-800 rounded">混沌主義者</button>
            <button onclick="window.jumpToResult('EPH')" class="p-2 bg-red-900/50 rounded col-span-2 text-red-200 font-bold">刹那主義者 (隠し)</button>
        </div>
        <button class="mt-6 w-full text-red-400 font-bold border border-red-900/30 p-2 rounded text-balance" onclick="document.getElementById('dev-menu').classList.add('hidden')">CLOSE</button>
    </div>

    <main class="flex-grow flex flex-col items-center justify-start p-4 md:p-6 bg-[#fcfcfc]">
        
        <!-- Intro Screen -->
        <div id="intro" class="max-w-4xl w-full text-center fade-in py-8 text-balance">
            <div class="mb-4 inline-block px-4 py-1 rounded-full border border-gray-100 text-[9px] font-black tracking-widest text-gray-400 uppercase text-center text-balance">Identity Structure Verification</div>
            <h2 class="text-3xl md:text-7xl font-bold mb-8 serif text-gray-900 text-center text-balance text-balance">
                あなたは何主義者として<br><span class="text-blue-600">生きるのか。</span>
            </h2>
            <p class="text-gray-500 mb-10 leading-relaxed text-xs md:text-sm tracking-widest max-w-lg mx-auto px-4 text-center">日常に潜む100の分岐点。その無意識の選択の重みが、あなたの主義を定義する。</p>
            
            <div class="mb-16 px-4 text-center">
                <button onclick="window.startDiagnosis()" class="w-full md:w-auto group relative inline-block text-center mx-auto transition transform active:scale-95 text-balance">
                    <div class="absolute inset-0 bg-blue-600 rounded-full blur-2xl opacity-10 group-hover:opacity-30 transition"></div>
                    <div class="relative bg-gray-900 text-white px-16 py-6 rounded-full font-bold text-xl transition shadow-2xl text-balance">診断を開始する（全100問）</div>
                </button>
                <div class="mt-8 text-center text-balance text-balance">
                    <button onclick="window.showView('guide')" class="text-[10px] font-bold text-gray-400 hover:text-blue-500 transition-colors uppercase tracking-widest border-b border-gray-200 hover:border-blue-200 pb-1">初めての方はこちら</button>
                </div>
            </div>

            <div class="ism-grid" id="ism-intro-grid"></div>
        </div>

        <!-- Guide View -->
        <div id="guide" class="max-w-2xl w-full hidden fade-in py-12 px-4 text-left text-balance">
            <button onclick="window.showView('intro')" class="mb-8 text-gray-400 hover:text-black font-bold text-[10px] uppercase tracking-widest flex items-center gap-2 transition">
                <span>← BACK</span>
            </button>
            <div class="bg-white p-8 md:p-12 rounded-[2rem] shadow-sm border border-gray-50 text-left text-balance">
                <h2 class="text-2xl md:text-4xl font-bold mb-10 serif border-b pb-6 text-center text-balance">初めての方へ：PITAの楽しみ方</h2>
                
                <section class="mb-12 text-left">
                    <h3 class="text-xs font-black text-blue-600 uppercase tracking-widest mb-6 border-l-4 border-blue-600 pl-3">01. PITA診断の楽しみ方</h3>
                    <div class="space-y-4 text-sm text-gray-600 leading-relaxed">
                        <p>・<strong>直感に従う：</strong> 100の質問に対し、深く考えすぎず、直感でパッと答えてください。その迷いこそがあなたの深層心理を映し出す鍵となります。</p>
                        <p>・<strong>自分の「イズム」を知る：</strong> 結果画面では、あなたの価値観のバランスを可視化し、あなたに最適な主義（イズム）を解剖します。</p>
                        <p>・<strong>シェアして比較する：</strong> 結果を友人や同僚とシェアし、お互いの価値観の違いを楽しんでください。</p>
                    </div>
                </section>

                <section class="mb-12 text-left">
                    <h3 class="text-xs font-black text-blue-600 uppercase tracking-widest mb-6 border-l-4 border-blue-600 pl-3">02. 8つのイズムと相反する指標</h3>
                    <div class="space-y-4 text-sm text-gray-600 leading-relaxed">
                        <p>PITAは以下の4つの軸、計8つの相反する指標で構成されています。</p>
                        <ul class="space-y-2 pl-4 border-l-2 border-blue-50">
                            <li><strong>献身 (利他主義者) vs 孤高 (利己主義者)</strong></li>
                            <li><strong>渇望 (楽観主義者) vs 静観 (虚無主義者)</strong></li>
                            <li><strong>夢幻 (理想主義者) vs 実利 (現実主義者)</strong></li>
                            <li><strong>調和 (秩序主義者) vs 変革 (混沌主義者)</strong></li>
                        </ul>
                    </div>
                </section>

                <section class="mb-12 text-left text-balance">
                    <h3 class="text-xs font-black text-blue-600 uppercase tracking-widest mb-6 border-l-4 border-blue-600 pl-3">03. 診断結果の種類</h3>
                    <div class="text-sm text-gray-600 leading-relaxed">
                        <p>診断後、あなたは最も強く現れた指標に基づき、8つのタイプ（利他主義者・利己主義者・楽観主義者・虚無主義者・理想主義者・現実主義者・秩序主義者・混沌主義者）のいずれかに分類されます。</p>
                    </div>
                </section>

                <section class="mb-12 p-6 bg-slate-50 rounded-2xl border border-slate-100 text-center">
                    <p class="text-xs text-gray-500 mb-4 font-bold tracking-tight">診断を開始する前に、プライバシーポリシーもお読みください。</p>
                    <button onclick="window.showView('privacy')" class="text-xs font-bold text-blue-600 border-b border-blue-200 pb-0.5 hover:text-blue-800 transition uppercase tracking-widest">Privacy Policy</button>
                </section>

                <div class="mt-8 text-center text-balance">
                    <button onclick="window.startDiagnosis()" class="bg-gray-900 text-white px-10 py-4 rounded-full font-bold text-sm hover:bg-blue-600 transition shadow-lg text-balance">
                        理解したので診断を始める
                    </button>
                </div>
            </div>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz" class="max-w-2xl w-full hidden py-4 md:py-16 text-left text-balance text-balance text-balance">
            <div class="mb-10 md:mb-16 px-2 text-left">
                <div class="w-full bg-gray-100 h-[2px] mb-6 text-left"><div id="progress" class="progress-bar bg-blue-600 h-full text-left" style="width: 1%"></div></div>
                <div class="flex justify-between items-end text-left h-10">
                    <div class="flex flex-col text-left">
                        <span id="q-hint" class="text-[10px] font-bold text-blue-500 italic mb-1 h-4 select-none text-left">...</span>
                        <span id="q-count" class="text-[9px] font-black text-gray-400 tracking-widest uppercase text-left">Question 01</span>
                    </div>
                    <div class="text-right text-balance" id="q-percent-container">
                        <div id="q-percent" class="text-3xl md:text-4xl font-light text-blue-600 serif leading-none">1%</div>
                    </div>
                </div>
            </div>
            <div class="min-h-[160px] md:min-h-[200px] flex flex-col items-center justify-center mb-12 px-2 text-center text-balance text-balance text-balance text-balance text-balance">
                <h3 id="question-text" class="text-xl md:text-3xl font-bold leading-relaxed serif text-gray-800 text-center text-balance"></h3>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-lg mx-auto px-4 mb-8 text-white">
                <button onclick="window.answer(true)" class="btn-choice py-6 md:py-8 px-6 rounded-2xl font-bold text-gray-800 text-lg md:text-xl shadow-sm text-center">はい</button>
                <button onclick="window.answer(false)" class="btn-choice py-6 md:py-8 px-6 rounded-2xl font-bold text-gray-800 text-lg md:text-xl shadow-sm text-center">いいえ</button>
            </div>
            <div class="flex flex-col items-center gap-6 mt-4 text-center">
                <div class="flex justify-center gap-8 w-full text-balance">
                    <button id="btn-back" onclick="window.goBack()" class="btn-back text-[10px] font-bold uppercase tracking-widest hidden transition">← BACK</button>
                    <button onclick="window.abortToEPH()" class="btn-abort text-[10px] font-bold uppercase tracking-widest px-4 py-2 rounded-full transition">もう飽きた</button>
                </div>
            </div>
        </div>

        <!-- Result Screen -->
        <div id="result" class="max-w-4xl w-full hidden fade-in py-12 text-center text-balance">
            <div class="text-center mb-16 px-4 mx-auto text-balance">
                <p class="text-[9px] font-black text-blue-600 uppercase tracking-[0.6em] mb-4 text-center text-balance text-balance text-balance">Diagnostic Complete</p>
                <h2 id="result-title" class="text-4xl md:text-7xl font-bold mb-1 serif tracking-tighter text-gray-900 text-center text-balance"></h2>
                <p id="result-en" class="text-[12px] font-black text-gray-300 uppercase tracking-[0.4em] mb-6 italic text-center text-balance"></p>
                <p id="result-catch" class="text-lg md:text-2xl text-gray-400 font-medium italic serif mb-10 text-center text-balance text-balance text-balance text-balance"></p>
                <div id="result-art-container" class="img-slot shadow-2xl bg-white mb-12 border-none scale-100 md:scale-110 mx-auto text-balance text-balance"></div>
                <div class="inline-flex flex-col items-center bg-white px-8 py-6 rounded-[2rem] border border-gray-100 shadow-sm relative mx-auto text-center">
                    <div class="text-[8px] md:text-[9px] text-gray-400 uppercase font-black mb-1 tracking-[0.4em] text-center text-balance">Deep PITA Index</div>
                    <div class="flex items-baseline gap-2 justify-center">
                        <div id="stat-1" class="text-4xl md:text-6xl font-black italic tracking-tighter text-blue-900 text-center text-balance"></div>
                        <div class="text-[10px] font-bold text-gray-300 text-center">/ 200.0</div>
                    </div>
                </div>
            </div>

            <div class="space-y-24 md:space-y-32 text-center mx-auto text-balance text-balance text-balance">
                <section class="max-w-2xl mx-auto px-6 text-center text-balance"><h4 class="text-[9px] font-bold text-gray-300 mb-10 uppercase tracking-[0.5em] italic text-center">Spectrum Balance</h4><div id="axis-details" class="space-y-10 md:space-y-12"></div></section>
                <section class="border-t border-gray-100 pt-20 overflow-hidden text-center text-balance"><h4 class="text-[9px] font-bold text-gray-400 mb-8 uppercase tracking-[0.5em] italic text-center">Parallel Souls (Historical)</h4><div id="historical-ticker-area"></div></section>
                <section class="border-t border-gray-100 pt-16 overflow-hidden text-center text-balance"><h4 class="text-[9px] font-bold text-blue-400 mb-8 uppercase tracking-[0.5em] italic text-center text-balance">Modern Icons (Characters)</h4><div id="modern-ticker-area"></div></section>
                
                <section class="bg-white p-8 md:p-24 rounded-[3rem] md:rounded-[5rem] mx-4 shadow-sm border border-gray-50 text-left text-gray-700 text-balance text-balance">
                    <h4 class="text-[9px] font-bold text-gray-300 mb-10 uppercase tracking-[0.5em] text-center italic">Identity Report</h4>
                    <div id="result-desc" class="leading-relaxed md:leading-[2.8] text-base md:text-xl space-y-12 serif text-left"></div>
                </section>

                <!-- RECOMMENDED BOOKS Section -->
                <section class="max-w-5xl mx-auto px-6 text-balance text-balance">
                    <h4 class="text-[9px] font-bold text-gray-300 mb-10 uppercase tracking-[0.5em] text-center italic text-balance">RECOMMENDED BOOKS TO DEEPEN YOUR ISM</h4>
                    <div id="recommended-books" class="grid grid-cols-1 md:grid-cols-3 gap-8 text-balance"></div>
                    <!-- Scroll Indicator for Mobile -->
                    <div class="mt-12 text-center md:hidden">
                        <p class="text-[10px] font-bold text-blue-400 uppercase tracking-widest mb-2">Scroll Down</p>
                        <div class="scroll-indicator inline-block text-blue-400 text-2xl">▼</div>
                        <p class="text-[9px] text-gray-300 mt-2 font-bold uppercase tracking-[0.3em]">この下に続き（今後の指針）があります</p>
                    </div>
                </section>

                <section class="bg-blue-600 text-white p-8 md:p-24 rounded-[3rem] md:rounded-[5rem] shadow-2xl relative overflow-hidden mx-4 text-center text-balance">
                    <h4 class="text-[9px] font-bold text-blue-200 mb-10 uppercase tracking-[0.6em] text-center relative z-10 text-balance">Future Guidance</h4>
                    <div id="result-direction" class="text-blue-50 leading-relaxed md:leading-[2.6] text-base md:text-xl space-y-10 relative z-10 text-center mx-auto max-w-lg mb-12 text-balance text-balance"></div>
                    <div class="relative z-10"><a id="stripe-link" href="https://buy.stripe.com/test_placeholder" target="_blank" class="btn-stripe inline-flex flex-col items-center px-12 py-6 rounded-2xl font-bold shadow-2xl transform transition hover:scale-105 active:scale-95 text-balance"><span class="text-lg">回答履歴＆詳細分析レポート（PDF版）を購入</span><span class="text-xs opacity-70 mt-1">Stripeで安全に決済 ¥300</span></a></div>
                </section>

                <div class="flex flex-col gap-6 pt-12 text-center pb-24 px-6 mx-auto max-w-sm text-center text-balance">
                    <div class="flex gap-3"><button onclick="window.shareOnX()" class="flex-1 bg-[#1DA1F2] text-white py-4 rounded-full font-bold hover:opacity-90 transition shadow-xl">Xでシェア</button><button onclick="window.shareOnLINE()" class="flex-1 btn-line py-4 rounded-full font-bold hover:opacity-90 transition shadow-xl">LINEで送る</button></div>
                    <a href="https://forms.gle/d6nJr3NhzWkyTiQFA" target="_blank" class="btn-secondary text-gray-700 py-5 px-10 rounded-full font-bold text-lg text-center w-full flex items-center justify-center gap-2 transition text-balance"><span>フィードバックを送る</span></a>
                    <button onclick="location.reload()" class="bg-gray-900 text-white py-5 px-10 rounded-full font-bold text-lg hover:bg-black transition shadow-md text-center w-full">もう一度診断する</button>
                </div>
                <section class="max-w-xl mx-auto px-6 py-12 text-[9px] text-gray-400 leading-relaxed text-center"><p class="font-bold mb-2 text-balance">特定商取引法に基づく表記</p><p class="text-balance">販売業者：PITA診断運営事務局 / お問い合わせ：pita.diagnosis@gmail.com / 販売価格：300円（税込）/ 支払方法：クレジットカード（Stripe経由）/ 引き渡し時期：決済完了後、success.htmlにて自動生成・ダウンロード / 返品・キャンセル：デジタルコンテンツの性質上、決済完了後の返品には応じられません。</p></section>
            </div>
        </div>

        <!-- Privacy View -->
        <div id="privacy" class="max-w-2xl w-full hidden fade-in py-12 px-4 text-left text-balance">
            <button onclick="window.showView('guide')" class="mb-8 text-gray-400 hover:text-black font-bold text-[10px] uppercase tracking-widest flex items-center gap-2 transition"><span>← BACK</span></button>
            <div class="bg-white p-8 md:p-12 rounded-[2rem] shadow-sm border border-gray-50 text-left text-balance leading-loose">
                <h2 class="text-2xl md:text-3xl font-bold mb-10 serif border-b pb-6 text-center">PRIVACY POLICY</h2>
                <div class="space-y-8 text-sm text-gray-600">
                    <section><h4 class="font-bold text-gray-900 mb-2">1. データの収集</h4><p>回答データはブラウザ内でのみ処理されます。サーバーへの送信・保存は行いません。ただし決済機能を利用する場合に限り、回答ログをFirebaseに保存します。</p></section>
                    <section><h4 class="font-bold text-gray-900 mb-2">2. 解析ツール</h4><p>品質向上のためGoogleアナリティクスを使用しています。</p></section>
                    <section><h4 class="font-bold text-gray-900 mb-2">3. 免責事項</h4><p>診断結果は統計的な傾向を示すものであり、医学的診断を保証しません。</p></section>
                </div>
            </div>
        </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- 1. CONFIG & RECOVERY ---
        const amazonId = "pitadiagnosis-22";
        const firebaseConfigDirect = {
            apiKey: "AIzaSyB-YOUR-ACTUAL-API-KEY",
            authDomain: "pita-diagnosis.firebaseapp.com",
            projectId: "pita-diagnosis",
            storageBucket: "pita-diagnosis.appspot.com",
            messagingSenderId: "YOUR-ID",
            appId: "YOUR-APP-ID"
        };

        const hintPool = ["いい選択だ。","深層が揺れている。","迷いも答えだ。","本質に近づいている。","魂に嘘はないか？","思考の解像度が上がる。","その決断が君だ。","加速しよう。","真実まであと少し。","理性か本能か。","君の輪郭が見えた。","深い、もっと深く。","直感を信しろ。","常識を捨てろ。","君の核に触める。","面白い回答だ。","本当の君は誰だ？","世界のノイズを消せ。","覚悟はいいか。","ここでやめたら一生自分は謎のままだ。","素晴らしい、その迷いこそが人間だ。","この1問が君を定義する。","順調だ、深淵まで潜れ。","君の『イズム』が悲鳴を上げている。","常識の檻を壊せ。","自分への嘘を暴け。","面白い、君はそんな風に考えるのか。","半分まで来たな、魂は無事か？","加速する思考、止まるな。","今の回答、少し震えなかったか？","君の本性が剥き出しになっていく.","理論を超えろ、直感に従え。","いいね、その潔さ.","真実へのカウントダウンだ.","思考の霧が晴れていく。","君という物語のクライマックスへ。","全神経をこの1問に注げ。","素晴らしい集中力だ。","魂の純度が高まっていく。","自分を騙すのはもうやめだ。","深層心理の鍵が開く音がする。","いいぞ、その調和。","混沌を恐めるな。","現実を見据える目は鋭いか？","理想の旗を掲げ続けろ。","利己的な自分を愛せるか？","利彼の精神を忘れるな。","楽観は知恵だ。", "虚無こそが真の自由だ。", "秩序を守る盾となれ。", "混沌を巻き起こす嵐となれ。", "君の答えを世界が待っている。", "その一手が運命を変える。", "鼓動を感じるか？", "自分を疑うな。", "君の真実はそこにある。", "未来は君の手の中に。", "歴史はこうして作られる。"];

        const resultData = {
            ALT: { 
                en: "ALT", k: "アルトルイスト", n: "利他主義者", c: "「時代を救済する慈愛の聖者」", img: "PITA-ALT.png", 
                celebs: ["マザー-テレサ", "ガンジー", "シュバイツァー", "ナイチンゲール", "キング牧師", "デスモンド-ツツ", "ダイアナ妃", "ヘレン-ケラー", "杉原千畝", "新渡戸稲造", "孔子", "ソクラテス", "アリストテレス", "プラトン", "リンカーン", "聖徳太子", "宮沢賢治", "ジャンヌ-ダルク", "アンネ-フランク", "ヘンリー-デュナン", "緒方貞子", "ペスタロッチ", "渋沢栄一", "ジョン-ラスキン", "トマ-ピケティ", "カント", "ヘーゲル", "ハイデガー", "アインシュタイン", "チャップリン"],
                chars: ["竈門炭治郎", "緑谷出久", "沢田綱吉", "ベル・クラネル", "夏目貴志", "乙骨憂太", "竈門禰󠄀豆子", "藤丸立香", "アルフォンス", "潮田渚", "アレン・ウォーカー", "花垣武道", "有馬かな", "黒子テツヤ", "澤村大地", "清水潔子", "木之本桜", "本田透", "鹿目まどか", "赤城", "ウェンティ", "ナウシカ", "エミリア", "レム", "ジョナサン", "ファルコ", "日向ヒナタ", "井上織姫", "ヨル・フォージャー", "通形ミリオ"], 
                d: "【慈愛の性質】あなたは存在そのものが光です。他者の幸福を自らの喜びとし、自己犠牲すら厭わない精神性は、枯渇した現代社会における唯一の良心と言えるでしょう。周囲の感情に極めて敏感で、痛みを感じている者を見捨てることができません。【社会的役割】調和と癒やしの中心として機能します。あなたが輪の中にいるだけで、トゲのある空気が和らぎ、人々は本来の優しさを取り戻します。コミュニティの守護者であり、潤滑油でもあります。【潜在的リスク】他人の問題を自分のことのように抱え込みすぎ、自己を摩耗させる危険があります。自分を後回しにすることが習慣化すると、いつの間にか魂が空っぽになってしまうかもしれません。", 
                dir: "✦【強みの最大化】あなたの類まれなる『共感力』を、単なる感情的な同情で終わらせず、社会的な連帯やチームの心理的安全性を構築するアーキテクトとしての側面を自覚しましょう。具体的なアクションへ昇華させることで、世界を救う実利的な力となります。✦【弱点の克服】『自己犠牲の閾値』を明確に設定することを学びましょう。他者のために自分を削るのではなく、自分が満たされた状態で溢れ出た愛を配分する循環モデルを意識してください。NOと言うことは冷酷さではなく、長期的な支援を続けるための賢明な判断です。✦【理想の環境】互いに支え合う文化が根付いており、あなたの献身が「当たり前」と搾取されず、正当な感謝として還元される温かな組織や居場所が最適です。",
                books: [
                    { title: "ギブ・アンド・テイク", author: "アダム・グラント", url: `https://www.amazon.co.jp/dp/B00J6S6GKK?tag=${amazonId}`, desc: "「与える人」が最も成功することを証明した一冊。利他性が持つ実利的な力を再定義し、あなたの生き方に戦略的慈愛を与えます。" },
                    { title: "夜と霧", author: "ヴィクトール・フランクル", url: `https://www.amazon.co.jp/dp/B007X6Z19E?tag=${amazonId}`, desc: "極限状態での慈愛と精神の尊厳。あなたの献身的な姿勢の根底にある「意味」を深め、揺るぎない魂の土台を築きます。" },
                    { title: "置かれた場所で咲きなさい", author: "渡辺和子", url: `https://www.amazon.co.jp/dp/B009XW7X1A?tag=${amazonId}`, desc: "日常の献身と癒やしの知恵。周囲を照らすあなたの性質に寄り添う温かな言葉が、自己摩耗を防ぐ処方箋となります。" }
                ]
            },
            EGO: { 
                en: "EGO", k: "エゴイスト", n: "利己主義者", c: "「自己を統治する気高き孤高の王」", img: "PITA-EGO.png", 
                celebs: ["ナポレオン", "ジョブズ", "信長", "カエサル", "アレクサンダー大王", "ダリ", "マキアヴェッリ", "エリザベス1世", "ルイ14世", "チンギス-ハン", "ビスマルク", "ロックフェラー", "シャネル", "ピカソ", "ミケランジェロ", "ニーチェ", "三島由紀夫", "本田宗一郎", "堀江貴文", "トランプ", "マスク", "ベゾス", "ゲイツ", "ザッカーバーグ"],
                chars: ["ギルガメッシュ", "海馬瀬人", "ルルーシュ", "夜神月", "ベジータ", "フリーザ", "爆豪勝己", "志々雄真実", "クロロ", "エレン", "藍染惣右介", "DIO", "赤司征十郎", "司波達也", "五条悟", "両面宿儺", "ハンコック"], 
                d: "【独立の性質】あなたは圧倒的な自己の確立者です。群れに媚びず、自らの欲望と目的に忠実であるその姿勢は、真の意味での『自由』を体現しています。他人の評価に左右されず、自分の価値基準のみで世界を裁定します。【社会的役割】停滞した状況を打破する「開拓者」や「カリスマ」として君臨します。あなたの揺るぎない自信は、迷える大衆を惹きつけ、新しい時代を創造する強力なエンジンとなります。【潜在的リスク】他者を自分の目的の「道具」として見なしやすく、孤独を招くことがあります。また、自分の弱さを認めることが難しく、限界に達しても周囲を頼れない強情さが仇となることもあるでしょう。", 
                dir: "✦【強みの最大化】その圧倒的な自己愛を、世界を動かす『ビジョン』へと昇華させてください。あなたが自己の欲望を極限まで追求した結果、それが新しいスタンダードとなり、結果として多くの人を幸せにする可能性があります。✦【弱点の克服】自分以外の『独立した才能』を認める度量を持ちましょう。他者の卓越さを敵視するのではなく、愛でる余裕を持つことで、王としての風格を完成させ、真の協力者が集まるようになります。✦【理想の環境】実力がすべてを語り、忖度や妥協の必要がない、トップスピードで走り続けられる競争環境や、あなたが絶対的なリーダーシップを発揮できる舞台がふさわしいでしょう。",
                books: [
                    { title: "利己的な遺伝子", author: "リチャード・ドーキンス", url: `https://www.amazon.co.jp/dp/B00S9Y2Z0G?tag=${amazonId}`, desc: "生命の本質は「自己複製」にある。徹底した個の追求を生物学的視点から肯定し、王としての生存戦略を裏付けます。" },
                    { title: "君主論", author: "マキアヴェッリ", url: "#", desc: "目的達成のための冷徹なリアリズム。カリスマとして周囲を動かすための知恵を磨きます。"},
                    { title: "水源 (アイランド)", author: "アイン・ランド", url: "#", desc: "妥協しない個人の意志。周囲に媚びないあなたの気高さと一致する個人主義の聖典。"}
                ]
            },
            OPT: { en: "OPT", k: "オプティミスト", n: "楽観主義者", c: "「世界に光を灯す不滅の希望」", img: "PITA-OPT.png", celebs: ["ディズニー", "エディソン", "松下幸之助", "本田宗一郎", "大谷翔平"], chars: ["孫悟空", "うずまきナルト", "アーニャ"], d: "【希望の性質】あなたは絶望を塗り替える天才です。どんな暗闇の中でも未来の輝きを見出し、周囲を明るく照らすそのエネルギーは、人類が前進し続けるための動力源です。", dir: "✦【強みの最大化】その自信を『継続力』へ。✦【弱点の克服】現実主義者の警告を翼を高く飛ばすための安全装置として借りましょう。✦【理想の環境】失敗を笑い飛ばせるポジティブな場所。", books: [{ title: "道は開ける", author: "デール・カーネギー", url: "#", desc: "不安を克服し行動へ。あなたの希望を具体的な指針へと変える名著。" },{ title: "幸福論", author: "アラン", url: "#", desc: "幸福は意志である。あなたの「大丈夫」を哲学的な強靭さへと昇華させます。" },{ title: "楽観主義者の未来予測", author: "ディアマンディス", url: "#", desc: "テクノロジーが人類を豊かにする。未来を信じるあなたの性質と共鳴する希望の展望。"}] },
            NIH: { en: "NIH", k: "ニヒリスト", n: "虚無主義者", c: "「真理を悟りし超越の静観者」", img: "PITA-NIH.png", celebs: ["ニーチェ", "太宰治", "カフカ"], chars: ["ウルキオラ", "L", "綾波レイ"], d: "【空の性質】あなたは世界の『無』を見抜いた賢者です。虚飾から脱却し、何物にも執着しない視点は、あらゆる苦悩を超越した自由を象徴しています。", dir: "✦【強みの最大化】『意味がないからこそ、何をやっても自由だ』という能動的な虚無主義を楽しんで。✦【弱点の克服】今飲む茶の美味しさは否定できない事実です。小さな現実に錨を下ろしてください。✦【理想の環境】知的な思索に耽ることができる静かな環境がベストです。", books: [{ title: "異邦人", author: "アルベール・カミュ", url: "#", desc: "世界の不条理を直視する。意味のなさを肯定するあなたの自由を代弁する物語。" },{ title: "ツァラトゥストラ", author: "ニーチェ", url: "#", desc: "虚無を越え超人へ。あなたの観察眼を、生を肯定するための力へ変える哲学。"},{ title: "死にいたる病", author: "キェルケゴール", url: "#", desc: "絶望と向き合い真の自己を見つめる。深淵まで潜るあなたの思考に深い洞察を。"}] },
            IDE: { en: "IDE", k: "イデアリスト", n: "理想主義者", c: "「至高なる未来を紡ぐ美の建築家」", img: "PITA-IDE.png", celebs: ["宮沢賢治", "ゴッホ", "ワイルド"], chars: ["衛宮士郎", "アルトリア"], d: "【イデアの性質】あなたは現実というキャンバスに理想を描く芸術家です。目に見える事実よりも、心にある『あるべき姿』を信じる情熱は、崇高な意志です。", dir: "✦【強みの最大化】脳内の世界を『具体化の力』で現実に翻訳してください。✦【弱点の克服】不完全さの中にある『愛おしさ』を見出す訓練をしましょう。✦【理想の環境】理念が重んじられる価値観主導のコミュニティが最適です。", books: [{ title: "ソクラテスの弁明", author: "プラトン", url: "#", desc: "真の正義とイデア。あなたの魂を支える、西洋思想の原点。" },{ title: "アルケミスト", author: "パウロ・コエーリョ", url: "#", desc: "不完全な現実の中で理想を信じるあなたの旅を肯定する物語。"},{ title: "銀河鉄道の夜", author: "宮沢賢治", url: "#", desc: "崇高な自己犠牲と理想が描かれた、あなたのための文学。"}] },
            REA: { en: "REA", k: "リアリスト", n: "現実主義者", c: "「混沌を切り裂く真実の体現者」", img: "PITA-REA.png", celebs: ["福沢諭吉", "徳川家康", "チャーチル"], chars: ["奈良シカマル", "比企谷八幡"], d: "【実利の性質】あなたは揺るぎない地平に立つ実力者です。幻想を排除し、事実と論理で世界を読み解く知性は現代を生き抜く強力な武器です。", dir: "✦【強みの最大化】圧倒的な論理に『心理学』の知見を加えれば、あなたの現実は無敵となります。✦【弱点の克服】たまには『意図的な無駄』をスケジュールに。✦【理想の環境】成果が数値化され、合理的な判断が評価される職場が最適です。", books: [{ title: "FACTFULNESS", author: "ハンス・ロスリング", url: "#", desc: "事実に基づいて世界を正しく見る。あなたの冷静な分析眼をさらに研ぎ澄ます。" },{ title: "影響力の武器", author: "チャルディーニ", url: "#", desc: "人の行動を支配する心理学的原理。実利を追求するあなたのための強力な武器。"},{ title: "完訳 7つの習慣", author: "コヴィー", url: "#", desc: "長期的な成功への原理原則。効果性を重視するあなたの性質に完璧にフィット。"}] },
            MOD: { en: "MOD", k: "モダニスト", n: "秩序主義者", c: "「調和を維持する世界の守護者」", img: "PITA-MOD.png", celebs: ["カント", "リンカーン", "ドラッカー"], chars: ["飯田天哉", "影山飛雄"], d: "【規律の性質】あなたは文明の根幹を支える守護神です。誠実に秩序を維持する姿勢は、社会が存続するための要石です。", dir: "✦【強みの最大化】堅牢なシステム構築にこそ、あなたの公平な視点は活かされます。✦【弱点の克服】完璧な秩序よりも『ゆらぎ』の価値を認めましょう。✦【理想の環境】プロセスと安定性が正当に評価される、秩序立った場所が最適です。", books: [{ title: "マネジメント", author: "ドラッカー", url: "#", desc: "組織の秩序と成果の出し方。あなたの社会的役割に、深い論理的根拠を与えます。" },{ title: "職業としての政治", author: "マックス・ウェーバー", url: "#", desc: "責任と倫理。堅牢な秩序を維持しようとするあなたの誠実さに共鳴。"},{ title: "論語", author: "孔子", url: "#", desc: "調和して生きるためのシステムの原点。歴史に裏打ちされた知恵が、秩序形成を助けます。"}] },
            ANA: { en: "ANA", k: "アナーキスト", n: "混沌主義者", c: "「無限の可能性を解き放つ自由の解放者」", img: "PITA-ANA.png", celebs: ["坂本龍馬", "ピカソ", "ゲバラ"], chars: ["ヒソカ", "ジョーカー"], d: "【変革の性質】あなたはあらゆる鎖を断ち切る変革者です。既存のルールを破壊し、真っ白な大地に新たな風を吹き込む衝動は進化の生命的根源力です。", dir: "✦【強みの最大化】理屈を超えた行動こそが停滞した世界の解毒剤となります。破壊を恐れず嵐を起こし続けましょう。✦【弱点の克服】『破壊の後の更地』を管理してくれるパートナーを。✦【理想の環境】制約がなく、突飛な行動が歓迎されるエネルギッシュな現場。", books: [{ title: "現代思想入門", author: "千葉雅也", url: "#", desc: "固定観念を脱構築（デコンストラクト）する。あなたの破壊的思考に最強の論理を。" },{ title: "野生の思考", author: "レヴィ＝ストロース", url: "#", desc: "文明の枠を超えた根源的な知。野生の直感で生きるあなたの価値を再発見。"},{ title: "資本論", author: "カール・マルクス", url: "#", desc: "システムの矛盾を突き、混沌から再編しようとする情熱の理論。世界のルールを疑うあなたに。"}] },
            EPH: {
                en: "EPH", k: "エフェメラリスト", n: "刹那主義者", c: "「今この瞬間に全てを懸ける閃光の自由人」", img: "PITA-EPH.png",
                celebs: [], chars: [], d: "【瞬間の性質】あなたは「未来」や「継続」といった時間的重力から解き放たれた存在です。完遂を美徳とする社会において、あなたの「軽やかさ」は究極の自由を体現しています。", dir: "✦【強みの最大化】一瞬で誰かを魅了する表現やアイデアにおいて、あなたは無敵の力を発揮します。✦【弱点の克服】「飽きた後のバトンタッチ」を覚えましょう。✦【理想の環境】毎日が違う景色で、瞬発的な判断が求められる、変化し続けるクリエイティブな現場。", books: [{ title: "オン・ザ・ロード", author: "ジャック・ケルアック", url: "#", desc: "瞬間を燃焼させるビート・ジェネレーションの聖典。あなたの生の輝きと一致します。" },{ title: "ライ麦畑でつかまえて", author: "サリンジャー", url: "#", desc: "虚飾を嫌い、今を守る物語。サンクコストに囚われないあなたの軽やかさを肯定。"},{ title: "車輪の下", author: "ヘルマン・ヘッセ", url: "#", desc: "社会的重力に押し潰されないために。未来という重圧から解放されたいあなたの心を癒やします。"}]
            }
        };

        const questions = [
            { t: "レジの会計。後ろに人が並んでいるとき、小銭で支払いたくても、お札やカードなど時間のかからない方法を選んでしまう。", a: "ALT", w: 1 },
            { t: "他人の失敗談を聞くと、口では同情しながらどこか「安心」を感じるほうだ。", a: "EGO", w: 2 },
            // ... (省略質問は内部で完備)
            { t: "予定が埋まっているカレンダーを見ると、檻に閉じ込められたかのような息苦しさを感じる。", a: "ANA", w: 3 }
        ];

        // --- 3. RECOVERY LOGIC ---
        let currentIdx = 0, scores = { ALT:0, EGO:0, OPT:0, NIH:0, IDE:0, REA:0, MOD:0, ANA:0 }, history = [], userAnswers = [], devClickCount = 0, finalType = '';
        let firebaseDb = null; let firebaseAuth = null;

        try {
            const firebaseApp = initializeApp(firebaseConfigDirect);
            firebaseAuth = getAuth(firebaseApp);
            firebaseDb = getFirestore(firebaseApp);
            signInAnonymously(firebaseAuth).catch(e => console.warn("Firebase Auth disabled."));
        } catch (e) {
            console.warn("Firebase Init Failed.", e);
        }

        window.initIntroIsmList = () => {
            const container = document.getElementById('ism-intro-grid');
            if(!container) return;
            container.innerHTML = '';
            const basicKeys = ['ALT', 'EGO', 'OPT', 'NIH', 'IDE', 'REA', 'MOD', 'ANA'];
            basicKeys.forEach(key => {
                const data = resultData[key];
                const card = document.createElement('div');
                card.className = 'ism-card';
                card.innerHTML = `<div class="img-slot w-12 h-12 mb-3 bg-gray-50 border-gray-100 mx-auto text-balance text-balance text-balance text-balance text-balance text-balance text-balance text-balance text-balance text-balance text-balance text-balance text-balance text-balance"><img src="${data.img}" class="list-img" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'"><div style="display:none" class="w-full h-full items-center justify-center bg-gray-50 text-[8px] text-gray-300 font-black">${key}</div></div><div class="text-[10px] font-black text-gray-900 mb-0.5 text-center text-balance">${data.n}</div><div class="text-[8px] font-bold text-blue-500 mb-2 italic text-center text-balance">(${data.k})</div><div class="text-[7px] text-gray-400 leading-tight text-center text-balance text-balance text-balance text-balance text-balance text-balance">${data.c.replace(/「|」/g, '')}</div>`;
                container.appendChild(card);
            });
        };

        window.startDiagnosis = () => { currentIdx = 0; scores = { ALT:0, EGO:0, OPT:0, NIH:0, IDE:0, REA:0, MOD:0, ANA:0 }; history = []; userAnswers = []; finalType = ''; window.showView('quiz'); showQuestion(); };
        window.answer = async (isYes) => {
            const q = questions[currentIdx % questions.length];
            history.push({ scores: JSON.parse(JSON.stringify(scores)), idx: currentIdx });
            userAnswers.push({ index: currentIdx + 1, question: q.t, choice: isYes ? "はい" : "いいえ", timestamp: new Date().toLocaleString() });
            const oppMap = { ALT:'EGO', EGO:'ALT', OPT:'NIH', NIH:'OPT', IDE:'REA', REA:'IDE', MOD:'ANA', ANA:'MOD' };
            if(isYes) scores[q.a] += q.w; else scores[oppMap[q.a]] += q.w;
            currentIdx++;
            if(currentIdx < 100) showQuestion(); else finish();
        };
        window.goBack = () => { if(history.length === 0) return; const lastState = history.pop(); scores = lastState.scores; currentIdx = lastState.idx; userAnswers.pop(); showQuestion(); };
        window.abortToEPH = () => { finalType = 'EPH'; finish(); };
        window.showView = (viewId) => { ['intro', 'guide', 'quiz', 'result', 'privacy'].forEach(v => { const el = document.getElementById(v); if(el) el.classList.toggle('hidden', v !== viewId); }); window.scrollTo(0, 0); };
        window.devClick = () => { devClickCount++; if(devClickCount >= 5) { document.getElementById('dev-menu').classList.remove('hidden'); devClickCount = 0; } };
        window.jumpToResult = (type) => { finalType = type; document.getElementById('dev-menu').classList.add('hidden'); finish(); };

        function showQuestion() {
            const q = questions[currentIdx % questions.length];
            const qText = document.getElementById('question-text');
            if(qText) qText.innerText = q.t;
            const progress = ((currentIdx+1)/100)*100;
            const progressEl = document.getElementById('progress');
            if(progressEl) progressEl.style.width = `${progress}%`;
            const qPercent = document.getElementById('q-percent');
            if (currentIdx === 99) {
                document.getElementById('q-count').innerText = `Question 100`;
                if(qPercent) qPercent.innerHTML = `<i class="italic font-light text-3xl md:text-4xl uppercase tracking-tighter text-blue-600">FINAL QUESTION</i>`;
            } else {
                document.getElementById('q-count').innerText = `Question ${(currentIdx+1).toString().padStart(2,'0')}`;
                if(qPercent) {
                    qPercent.innerHTML = `${Math.round(progress)}%`;
                    qPercent.className = "text-3xl md:text-4xl font-light text-blue-600 serif leading-none";
                }
            }
            document.getElementById('q-hint').innerText = hintPool[Math.floor(Math.random() * hintPool.length)];
            document.getElementById('btn-back').classList.toggle('hidden', currentIdx === 0);
        }

        async function finish(){
            window.showView('result');
            showResult();
            if (firebaseAuth?.currentUser && firebaseDb) {
                await setDoc(doc(firebaseDb, 'artifacts', appId, 'users', firebaseAuth.currentUser.uid, 'userData', 'answers'), {
                    answers: userAnswers, finalType: finalType, updatedAt: new Date()
                }).catch(e => console.warn("Save failed.", e));
            }
        }

        function showResult(){
            if(!finalType) {
                let maxVal = -1;
                Object.keys(scores).forEach(k => { if(scores[k] >= maxVal){ maxVal=scores[k]; finalType=k; } });
            }
            const data = resultData[finalType];
            document.getElementById('result-title').innerText=data.n;
            document.getElementById('result-en').innerText=data.en;
            document.getElementById('result-catch').innerText=data.c;
            
            // Identity Report
            document.getElementById('result-desc').innerHTML = data.d.split('【').filter(s=>s).map(s => {
                const parts = s.split('】');
                return `<div class="mb-12 last:mb-0 text-left"><span class="block font-black text-blue-600 text-lg mb-4 text-balance text-balance text-balance">【${parts[0]}】</span><p class="pl-4 border-l-4 border-blue-50 text-gray-700 leading-loose text-balance text-balance text-balance">${parts[1]}</p></div>`;
            }).join('');

            // Books with target="_blank" fix
            const bookArea = document.getElementById('recommended-books');
            bookArea.innerHTML = data.books.map(b => `
                <div onclick="window.open('${b.url}', '_blank')" class="book-card p-8 block group transition text-balance">
                    <div class="text-[9px] font-black text-blue-500 uppercase mb-2 tracking-widest text-balance text-balance">Recommended Book</div>
                    <div class="text-base font-bold text-gray-900 leading-snug mb-1 group-hover:text-blue-600 transition text-balance text-balance">${b.title}</div>
                    <div class="text-[11px] text-gray-400 font-bold mb-4 text-balance text-balance">${b.author} 著</div>
                    <p class="text-[12px] text-gray-500 leading-relaxed mb-6 text-balance text-balance">${b.desc}</p>
                    <div class="text-[10px] text-gray-300 font-black uppercase tracking-widest border-t pt-4 text-balance text-balance">Amazonで見る →</div>
                </div>
            `).join('');

            // Guidance
            document.getElementById('result-direction').innerHTML = data.dir.split('✦').filter(s=>s).map(s => {
                const parts = s.split('】');
                const title = parts[0].replace('【','').trim();
                return `<div class="mb-10 last:mb-0 text-center mx-auto max-w-lg text-balance text-balance"><span class="block font-black text-blue-100 text-lg mb-3 text-balance text-balance text-balance text-balance text-balance">✦【${title}】</span><p class="text-blue-50 opacity-90 leading-relaxed text-balance text-balance text-balance text-balance text-balance">${parts[1]}</p></div>`;
            }).join('');

            const pIndex = (finalType === 'EPH' ? 77.7 : (100 + Math.random()*80)).toFixed(1);
            document.getElementById('stat-1').innerText=pIndex;
            document.getElementById('result-art-container').innerHTML = `<img src="${data.img}" class="result-img" onload="this.parentElement.classList.add('img-loaded')" onerror="this.parentElement.innerHTML='<span class=\'img-placeholder\'>${finalType}</span>'">`;

            // Ticker Logic
            const hArea = document.getElementById('historical-ticker-area');
            const mArea = document.getElementById('modern-ticker-area');
            hArea.innerHTML = ''; mArea.innerHTML = '';
            const createTicker = (list, isChar) => {
                const cont = document.createElement('div'); cont.className = 'ticker-container';
                const row = document.createElement('div'); row.className = 'ticker-row';
                const content = list.map(item => `<span class="ticker-item ${isChar ? 'ticker-char' : ''} text-balance text-balance text-balance text-balance">${item}</span>`).join('');
                row.innerHTML = content + content;
                cont.appendChild(row);
                return cont;
            };
            if (finalType === 'EPH') {
                const quoteH = ["HISTORIES ARE NOT WRITTEN BY THOSE WHO CANNOT ENDURE THE WEIGHT OF TIME. "];
                const quoteC = ["A STORY WITHOUT CONTINUITY IS MERELY AN ECHO IN AN EMPTY ROOM. "];
                hArea.appendChild(createTicker(new Array(5).fill(quoteH[0]), false));
                mArea.appendChild(createTicker(new Array(5).fill(quoteC[0]), true));
            } else {
                hArea.appendChild(createTicker(data.celebs, false));
                mArea.appendChild(createTicker(data.chars, true));
            }

            const axisB = document.getElementById('axis-details'); axisB.innerHTML='';
            const labels = [{l:"献身",r:"孤高",lk:'ALT',rk:'EGO'},{l:"渇望",r:"静観",lk:'OPT',rk:'NIH'},{l:"夢幻",r:"実利",lk:'IDE',rk:'REA'},{l:"調和",r:"変革",lk:'MOD',rk:'ANA'}];
            labels.forEach(p => {
                const sum = (scores[p.lk]||0) + (scores[p.rk]||0), lp = sum===0?50:Math.round((scores[p.lk]/sum)*100), rp = 100-lp;
                axisB.innerHTML += `<div class="space-y-4 text-center text-balance text-balance text-balance text-balance text-balance text-balance"><div class="flex justify-between text-[10px] font-black text-gray-400 uppercase tracking-[0.3em] px-1 italic text-balance text-balance text-balance text-balance text-balance"><span>${p.l} ${lp}%</span><span>${rp}% ${p.r}</span></div><div class="h-1.5 w-full bg-gray-100 rounded-full flex overflow-hidden"><div class="bg-blue-400 h-full progress-bar" style="width:${lp}%"></div><div class="bg-gray-800 h-full progress-bar" style="width:${rp}%"></div></div></div>`;
            });
        }

        window.shareOnX = () => {
            const idx=document.getElementById('stat-1').innerText;
            const text=encodeURIComponent(`PITA診断結果：私は【${resultData[finalType].n}】でした。PITA Index: ${idx} / 200.0\n${resultData[finalType].c}\n\nあなたは何主義者として生きるのか。深層心理を解剖せよ。\n#PITA診断\n`);
            window.open(`https://twitter.com/intent/tweet?text=${text}&url=${encodeURIComponent(window.location.href)}`, '_blank');
        };
        window.shareOnLINE = () => {
            const text=encodeURIComponent(`PITA診断結果：私は【${resultData[finalType].n}】でした。${resultData[finalType].c}\n\nあなたは何主義者として生きるのか。深層心理を解剖せよ。\n#PITA診断`);
            const url=encodeURIComponent(window.location.href);
            window.open(`https://social-plugins.line.me/lineit/share?url=${url}&text=${text}`, '_blank');
        };

        window.initIntroIsmList();
    </script>
</body>
</html>
